<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_ticket" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <result column="id" property="id" jdbcType="INTEGER" />
    <result column="codigo" property="codigo" jdbcType="VARCHAR" />
    <result column="id_sucursal" property="idSucursal" jdbcType="INTEGER" />
    <result column="hora_emision" property="horaEmision" jdbcType="TIME" />
    <result column="hora_inicio_atencion" property="horaInicioAtencion" jdbcType="TIME" />
    <result column="hora_fin_atencion" property="horaFinAtencion" jdbcType="TIME" />
    <result column="id_subgrupo" property="idSubgrupo" jdbcType="INTEGER" />
    <result column="hora_inicio_reactivacion" property="horaInicioReactivacion" jdbcType="TIME" />
    <result column="hora_fin_reactivacion" property="horaFinReactivacion" jdbcType="TIME" />
    <result column="fecha_hora_prog_alg_2_tiempo" property="fechaHoraProgAlg2Tiempo" jdbcType="TIME" />
    <result column="estado" property="estado" jdbcType="INTEGER" />
    <result column="secuencia_algo_3_proporcion" property="secuenciaAlgo3Proporcion" jdbcType="INTEGER" />
    <result column="id_ticket_derivado" property="idTicketDerivado" jdbcType="INTEGER" />
    <result column="nombre_subgrupo" property="nombreSubgrupo" jdbcType="VARCHAR" />
    <result column="prefijo" property="prefijo" jdbcType="CHAR" />
    <result column="id_ventanilla_derivacion" property="idVentanillaDerivacion" jdbcType="INTEGER" />
    <result column="activa_audio_texto" property="activaAudioTexto" jdbcType="INTEGER" />
    <result column="tipo_identificacion" property="tipoIdentificacion" jdbcType="INTEGER" />
    <result column="numero_identificacion" property="numeroIdentificacion" jdbcType="VARCHAR" />
    <result column="descripcion" property="descripcion" jdbcType="VARCHAR" />
    <result column="ventanilla_id_usuario" property="ventanillaIdUsuario" jdbcType="INTEGER" />
    <result column="ticket_secuencia" property="ticketSecuencia" jdbcType="INTEGER" />
    <result column="envia_audio" property="enviaAudio" jdbcType="INTEGER" />
    <result column="ventanilla_caja" property="ventanillaCaja" jdbcType="INTEGER" />
    <result column="evaluacion" property="evaluacion" jdbcType="INTEGER" />
    <result column="fecha_atencion" property="fechaAtencion" jdbcType="DATE" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="pe.gob.ep.iclassq.negocio.bean.TicketCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select id, codigo, id_sucursal, hora_emision, hora_inicio_atencion, hora_fin_atencion,
      id_subgrupo, hora_inicio_reactivacion, hora_fin_reactivacion, fecha_hora_prog_alg_2_tiempo,
      estado, secuencia_algo_3_proporcion, id_ticket_derivado, nombre_subgrupo, prefijo,
      id_ventanilla_derivacion, activa_audio_texto, tipo_identificacion, numero_identificacion,
      descripcion, ventanilla_id_usuario, ticket_secuencia, envia_audio, ventanilla_caja,
      evaluacion, fecha_atencion
    from tbl_ticket
    <isParameterPresent >
      <include refid="tbl_ticket.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select id, codigo, id_sucursal, hora_emision, hora_inicio_atencion, hora_fin_atencion,
      id_subgrupo, hora_inicio_reactivacion, hora_fin_reactivacion, fecha_hora_prog_alg_2_tiempo,
      estado, secuencia_algo_3_proporcion, id_ticket_derivado, nombre_subgrupo, prefijo,
      id_ventanilla_derivacion, activa_audio_texto, tipo_identificacion, numero_identificacion,
      descripcion, ventanilla_id_usuario, ticket_secuencia, envia_audio, ventanilla_caja,
      evaluacion, fecha_atencion
    from tbl_ticket
    where id = #id:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from tbl_ticket
    where id = #id:INTEGER#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="pe.gob.ep.iclassq.negocio.bean.TicketCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from tbl_ticket
    <include refid="tbl_ticket.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <selectKey keyProperty="id" resultClass="java.lang.Integer" type="post">
		SELECT LAST_INSERT_ID()
	</selectKey>
    insert into tbl_ticket (id, codigo, id_sucursal, hora_emision, hora_inicio_atencion,
      hora_fin_atencion, id_subgrupo, hora_inicio_reactivacion, hora_fin_reactivacion,
      fecha_hora_prog_alg_2_tiempo, estado, secuencia_algo_3_proporcion, id_ticket_derivado,
      nombre_subgrupo, prefijo, id_ventanilla_derivacion, activa_audio_texto, tipo_identificacion,
      numero_identificacion, descripcion, ventanilla_id_usuario, ticket_secuencia, envia_audio,
      ventanilla_caja, evaluacion, fecha_atencion)
    values (#id:INTEGER#, #codigo:VARCHAR#, #idSucursal:INTEGER#, #horaEmision:TIME#,
      #horaInicioAtencion:TIME#, #horaFinAtencion:TIME#, #idSubgrupo:INTEGER#,
      #horaInicioReactivacion:TIME#, #horaFinReactivacion:TIME#, #fechaHoraProgAlg2Tiempo:TIME#,
      #estado:INTEGER#, #secuenciaAlgo3Proporcion:INTEGER#, #idTicketDerivado:INTEGER#,
      #nombreSubgrupo:VARCHAR#, #prefijo:CHAR#, #idVentanillaDerivacion:INTEGER#,
      #activaAudioTexto:INTEGER#, #tipoIdentificacion:INTEGER#, #numeroIdentificacion:VARCHAR#,
      #descripcion:VARCHAR#, #ventanillaIdUsuario:INTEGER#, #ticketSecuencia:INTEGER#,
      #enviaAudio:INTEGER#, #ventanillaCaja:INTEGER#, #evaluacion:INTEGER#, #fechaAtencion:DATE#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into tbl_ticket
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        id
      </isNotNull>
      <isNotNull prepend="," property="codigo" >
        codigo
      </isNotNull>
      <isNotNull prepend="," property="idSucursal" >
        id_sucursal
      </isNotNull>
      <isNotNull prepend="," property="horaEmision" >
        hora_emision
      </isNotNull>
      <isNotNull prepend="," property="horaInicioAtencion" >
        hora_inicio_atencion
      </isNotNull>
      <isNotNull prepend="," property="horaFinAtencion" >
        hora_fin_atencion
      </isNotNull>
      <isNotNull prepend="," property="idSubgrupo" >
        id_subgrupo
      </isNotNull>
      <isNotNull prepend="," property="horaInicioReactivacion" >
        hora_inicio_reactivacion
      </isNotNull>
      <isNotNull prepend="," property="horaFinReactivacion" >
        hora_fin_reactivacion
      </isNotNull>
      <isNotNull prepend="," property="fechaHoraProgAlg2Tiempo" >
        fecha_hora_prog_alg_2_tiempo
      </isNotNull>
      <isNotNull prepend="," property="estado" >
        estado
      </isNotNull>
      <isNotNull prepend="," property="secuenciaAlgo3Proporcion" >
        secuencia_algo_3_proporcion
      </isNotNull>
      <isNotNull prepend="," property="idTicketDerivado" >
        id_ticket_derivado
      </isNotNull>
      <isNotNull prepend="," property="nombreSubgrupo" >
        nombre_subgrupo
      </isNotNull>
      <isNotNull prepend="," property="prefijo" >
        prefijo
      </isNotNull>
      <isNotNull prepend="," property="idVentanillaDerivacion" >
        id_ventanilla_derivacion
      </isNotNull>
      <isNotNull prepend="," property="activaAudioTexto" >
        activa_audio_texto
      </isNotNull>
      <isNotNull prepend="," property="tipoIdentificacion" >
        tipo_identificacion
      </isNotNull>
      <isNotNull prepend="," property="numeroIdentificacion" >
        numero_identificacion
      </isNotNull>
      <isNotNull prepend="," property="descripcion" >
        descripcion
      </isNotNull>
      <isNotNull prepend="," property="ventanillaIdUsuario" >
        ventanilla_id_usuario
      </isNotNull>
      <isNotNull prepend="," property="ticketSecuencia" >
        ticket_secuencia
      </isNotNull>
      <isNotNull prepend="," property="enviaAudio" >
        envia_audio
      </isNotNull>
      <isNotNull prepend="," property="ventanillaCaja" >
        ventanilla_caja
      </isNotNull>
      <isNotNull prepend="," property="evaluacion" >
        evaluacion
      </isNotNull>
      <isNotNull prepend="," property="fechaAtencion" >
        fecha_atencion
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        #id:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="codigo" >
        #codigo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="idSucursal" >
        #idSucursal:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="horaEmision" >
        #horaEmision:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaInicioAtencion" >
        #horaInicioAtencion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaFinAtencion" >
        #horaFinAtencion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="idSubgrupo" >
        #idSubgrupo:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="horaInicioReactivacion" >
        #horaInicioReactivacion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaFinReactivacion" >
        #horaFinReactivacion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="fechaHoraProgAlg2Tiempo" >
        #fechaHoraProgAlg2Tiempo:TIME#
      </isNotNull>
      <isNotNull prepend="," property="estado" >
        #estado:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="secuenciaAlgo3Proporcion" >
        #secuenciaAlgo3Proporcion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="idTicketDerivado" >
        #idTicketDerivado:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="nombreSubgrupo" >
        #nombreSubgrupo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="prefijo" >
        #prefijo:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="idVentanillaDerivacion" >
        #idVentanillaDerivacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="activaAudioTexto" >
        #activaAudioTexto:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tipoIdentificacion" >
        #tipoIdentificacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="numeroIdentificacion" >
        #numeroIdentificacion:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="descripcion" >
        #descripcion:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ventanillaIdUsuario" >
        #ventanillaIdUsuario:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="ticketSecuencia" >
        #ticketSecuencia:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="enviaAudio" >
        #enviaAudio:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="ventanillaCaja" >
        #ventanillaCaja:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="evaluacion" >
        #evaluacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="fechaAtencion" >
        #fechaAtencion:DATE#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="pe.gob.ep.iclassq.negocio.bean.TicketCriteria" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select count(*) from tbl_ticket
    <include refid="tbl_ticket.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_ticket
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.id" >
        id = #record.id:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.codigo" >
        codigo = #record.codigo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.idSucursal" >
        id_sucursal = #record.idSucursal:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.horaEmision" >
        hora_emision = #record.horaEmision:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.horaInicioAtencion" >
        hora_inicio_atencion = #record.horaInicioAtencion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.horaFinAtencion" >
        hora_fin_atencion = #record.horaFinAtencion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.idSubgrupo" >
        id_subgrupo = #record.idSubgrupo:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.horaInicioReactivacion" >
        hora_inicio_reactivacion = #record.horaInicioReactivacion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.horaFinReactivacion" >
        hora_fin_reactivacion = #record.horaFinReactivacion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.fechaHoraProgAlg2Tiempo" >
        fecha_hora_prog_alg_2_tiempo = #record.fechaHoraProgAlg2Tiempo:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.estado" >
        estado = #record.estado:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.secuenciaAlgo3Proporcion" >
        secuencia_algo_3_proporcion = #record.secuenciaAlgo3Proporcion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.idTicketDerivado" >
        id_ticket_derivado = #record.idTicketDerivado:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.nombreSubgrupo" >
        nombre_subgrupo = #record.nombreSubgrupo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.prefijo" >
        prefijo = #record.prefijo:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.idVentanillaDerivacion" >
        id_ventanilla_derivacion = #record.idVentanillaDerivacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.activaAudioTexto" >
        activa_audio_texto = #record.activaAudioTexto:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.tipoIdentificacion" >
        tipo_identificacion = #record.tipoIdentificacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.numeroIdentificacion" >
        numero_identificacion = #record.numeroIdentificacion:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.descripcion" >
        descripcion = #record.descripcion:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.ventanillaIdUsuario" >
        ventanilla_id_usuario = #record.ventanillaIdUsuario:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.ticketSecuencia" >
        ticket_secuencia = #record.ticketSecuencia:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.enviaAudio" >
        envia_audio = #record.enviaAudio:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.ventanillaCaja" >
        ventanilla_caja = #record.ventanillaCaja:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.evaluacion" >
        evaluacion = #record.evaluacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.fechaAtencion" >
        fecha_atencion = #record.fechaAtencion:DATE#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_ticket.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_ticket
    set id = #record.id:INTEGER#,
      codigo = #record.codigo:VARCHAR#,
      id_sucursal = #record.idSucursal:INTEGER#,
      hora_emision = #record.horaEmision:TIME#,
      hora_inicio_atencion = #record.horaInicioAtencion:TIME#,
      hora_fin_atencion = #record.horaFinAtencion:TIME#,
      id_subgrupo = #record.idSubgrupo:INTEGER#,
      hora_inicio_reactivacion = #record.horaInicioReactivacion:TIME#,
      hora_fin_reactivacion = #record.horaFinReactivacion:TIME#,
      fecha_hora_prog_alg_2_tiempo = #record.fechaHoraProgAlg2Tiempo:TIME#,
      estado = #record.estado:INTEGER#,
      secuencia_algo_3_proporcion = #record.secuenciaAlgo3Proporcion:INTEGER#,
      id_ticket_derivado = #record.idTicketDerivado:INTEGER#,
      nombre_subgrupo = #record.nombreSubgrupo:VARCHAR#,
      prefijo = #record.prefijo:CHAR#,
      id_ventanilla_derivacion = #record.idVentanillaDerivacion:INTEGER#,
      activa_audio_texto = #record.activaAudioTexto:INTEGER#,
      tipo_identificacion = #record.tipoIdentificacion:INTEGER#,
      numero_identificacion = #record.numeroIdentificacion:VARCHAR#,
      descripcion = #record.descripcion:VARCHAR#,
      ventanilla_id_usuario = #record.ventanillaIdUsuario:INTEGER#,
      ticket_secuencia = #record.ticketSecuencia:INTEGER#,
      envia_audio = #record.enviaAudio:INTEGER#,
      ventanilla_caja = #record.ventanillaCaja:INTEGER#,
      evaluacion = #record.evaluacion:INTEGER#,
      fecha_atencion = #record.fechaAtencion:DATE#
    <isParameterPresent >
      <include refid="tbl_ticket.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_ticket
    <dynamic prepend="set" >
      <isNotNull prepend="," property="codigo" >
        codigo = #codigo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="idSucursal" >
        id_sucursal = #idSucursal:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="horaEmision" >
        hora_emision = #horaEmision:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaInicioAtencion" >
        hora_inicio_atencion = #horaInicioAtencion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaFinAtencion" >
        hora_fin_atencion = #horaFinAtencion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="idSubgrupo" >
        id_subgrupo = #idSubgrupo:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="horaInicioReactivacion" >
        hora_inicio_reactivacion = #horaInicioReactivacion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaFinReactivacion" >
        hora_fin_reactivacion = #horaFinReactivacion:TIME#
      </isNotNull>
      <isNotNull prepend="," property="fechaHoraProgAlg2Tiempo" >
        fecha_hora_prog_alg_2_tiempo = #fechaHoraProgAlg2Tiempo:TIME#
      </isNotNull>
      <isNotNull prepend="," property="estado" >
        estado = #estado:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="secuenciaAlgo3Proporcion" >
        secuencia_algo_3_proporcion = #secuenciaAlgo3Proporcion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="idTicketDerivado" >
        id_ticket_derivado = #idTicketDerivado:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="nombreSubgrupo" >
        nombre_subgrupo = #nombreSubgrupo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="prefijo" >
        prefijo = #prefijo:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="idVentanillaDerivacion" >
        id_ventanilla_derivacion = #idVentanillaDerivacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="activaAudioTexto" >
        activa_audio_texto = #activaAudioTexto:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="tipoIdentificacion" >
        tipo_identificacion = #tipoIdentificacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="numeroIdentificacion" >
        numero_identificacion = #numeroIdentificacion:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="descripcion" >
        descripcion = #descripcion:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ventanillaIdUsuario" >
        ventanilla_id_usuario = #ventanillaIdUsuario:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="ticketSecuencia" >
        ticket_secuencia = #ticketSecuencia:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="enviaAudio" >
        envia_audio = #enviaAudio:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="ventanillaCaja" >
        ventanilla_caja = #ventanillaCaja:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="evaluacion" >
        evaluacion = #evaluacion:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="fechaAtencion" >
        fecha_atencion = #fechaAtencion:DATE#
      </isNotNull>
    </dynamic>
    where id = #id:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="pe.gob.ep.iclassq.negocio.bean.Ticket" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_ticket
    set codigo = #codigo:VARCHAR#,
      id_sucursal = #idSucursal:INTEGER#,
      hora_emision = #horaEmision:TIME#,
      hora_inicio_atencion = #horaInicioAtencion:TIME#,
      hora_fin_atencion = #horaFinAtencion:TIME#,
      id_subgrupo = #idSubgrupo:INTEGER#,
      hora_inicio_reactivacion = #horaInicioReactivacion:TIME#,
      hora_fin_reactivacion = #horaFinReactivacion:TIME#,
      fecha_hora_prog_alg_2_tiempo = #fechaHoraProgAlg2Tiempo:TIME#,
      estado = #estado:INTEGER#,
      secuencia_algo_3_proporcion = #secuenciaAlgo3Proporcion:INTEGER#,
      id_ticket_derivado = #idTicketDerivado:INTEGER#,
      nombre_subgrupo = #nombreSubgrupo:VARCHAR#,
      prefijo = #prefijo:CHAR#,
      id_ventanilla_derivacion = #idVentanillaDerivacion:INTEGER#,
      activa_audio_texto = #activaAudioTexto:INTEGER#,
      tipo_identificacion = #tipoIdentificacion:INTEGER#,
      numero_identificacion = #numeroIdentificacion:VARCHAR#,
      descripcion = #descripcion:VARCHAR#,
      ventanilla_id_usuario = #ventanillaIdUsuario:INTEGER#,
      ticket_secuencia = #ticketSecuencia:INTEGER#,
      envia_audio = #enviaAudio:INTEGER#,
      ventanilla_caja = #ventanillaCaja:INTEGER#,
      evaluacion = #evaluacion:INTEGER#,
      fecha_atencion = #fechaAtencion:DATE#
    where id = #id:INTEGER#
  </update>
  
  <!-- querys adicionales -->
	<resultMap id="getResultTicketXArea" class="pe.gob.ep.iclassq.entidad.BeanTicketXArea">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="codigo" property="codigo" jdbcType="VARCHAR" />
		<result column="hora_inicio_atencion" property="horaInicioAtencion" jdbcType="TIME" />
		<result column="hora_fin_atencion" property="horaFinAtencion" jdbcType="TIME" />
		<result column="numero_identificacion" 	property="numeroIdentificacion" jdbcType="VARCHAR" />
		<result column="tipo_identificacion" 	property="tipoIdentificacion" jdbcType="VARCHAR" />
		<result column="descripcion" 	property="descripcion" jdbcType="VARCHAR" />
		<result column="nombreAlgoritmo" property="nombreAlgoritmo" jdbcType="VARCHAR" />
		<result column="fecha_atencion" property="fechaAtencion" jdbcType="DATE" />
		<result column="nombreVentanilla" property="nombreVentanilla" jdbcType="VARCHAR" />
		<result column="nombreUsuario" property="nombreUsuario" jdbcType="VARCHAR" />
		<result column="nombreGrupo" property="nombreGrupo" jdbcType="VARCHAR" />
		<result column="nombreSubGrupo" property="nombreSubGrupo" jdbcType="VARCHAR" />
		<result column="horaTicket" property="horaTicket" jdbcType="TIME" />
		<result column="tiempoAtencion" property="tiempoAtencion" 	jdbcType="TIME" />
		<result column="tiempoEspera" property="tiempoEspera" jdbcType="TIME" />
		<result column="estadoDescripcion" property="estadoDescripcion" jdbcType="VARCHAR" />
		<result column="tipoAnulacion" property="tipoAnulacion" jdbcType="VARCHAR" />
		<result column="descripcionAnulacion" 	property="descripcionAnulacion" jdbcType="VARCHAR" />
		<result column="evaluacion" property="evaluacion" jdbcType="VARCHAR" />
<!-- 		<result column="audio" property="audio" jdbcType="VARCHAR" /> -->
	</resultMap>
	<!-- <select id="actualizarTicketByTiempo" parameterClass="java.util.HashMap" 
		resultMap="getResultTicket" > -->
	<!-- UPDATE tbl_ticket t INNER JOIN tbl_subgrupo s ON s.id = t.id_subgrupo -->
	<!-- SET t.fecha_hora_prog_alg_2_tiempo = t.hora_emision + s.prior_tiempo_alg_2 -->
	<!-- WHERE t.estado = #estado:INTEGER#, AND t.fecha_atencion = CURDATE() -->
	<!-- </select> -->

	<select id="listarAtencionesXArea"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXArea">
		SELECT t.id,
		CASE WHEN a.descripcion is NULL THEN '--' ELSE a.descripcion END as area,
        CASE WHEN v.nombre is NULL THEN '--' ELSE v.nombre END as nombreVentanilla,
        CASE WHEN user.v_usuario_username is NULL THEN 'CONSULTA' ELSE user.v_usuario_username END as nombreUsuario,
		<!--a.descripcion as area,
		v.nombre as nombreVentanilla,
		user.v_usuario_username as nombreUsuario,-->
		t.codigo,
		t.tipo_identificacion,
		t.numero_identificacion,
		t.descripcion,
		t.fecha_atencion,
		g.nombre as nombreGrupo,
		s.nombre as nombreSubGrupo,
		t.hora_inicio_atencion,
		t.hora_fin_atencion,
		al.descripcion as nombreAlgoritmo,
		t.hora_emision as horaTicket,
		TIMEDIFF(if (t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_fin_atencion, t.hora_inicio_atencion), if (t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_inicio_atencion, t.hora_fin_atencion)) as tiempoAtencion,
		TIMEDIFF(if (t.hora_inicio_atencion>t.hora_emision, t.hora_inicio_atencion, t.hora_emision), if (t.hora_inicio_atencion>t.hora_emision, t.hora_emision, t.hora_inicio_atencion)) as tiempoEspera,
		tad.tipo as tipoAnulacion,
		tad.descripcion as descripcionAnulacion,
		t_estado.descripcion as estadoDescripcion,
		t_evaluacion.descripcion as evaluacion
		from tbl_ticket t
		inner join 	tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		left join tbl_ventanilla v on v.id = t.ventanilla_caja
		left join tbl_area a on a.id = v.id_area
		left JOIN ctrl_seg_usuario user ON user.i_usuario_id = t.ventanilla_id_usuario  
		left join tbl_tabla_general t_estado on t_estado.TABLA='ESTADO_TICKET' and t_estado.codigoint=t.estado 
		left join tbl_tabla_general	t_evaluacion on t_evaluacion.TABLA='EVALUACION_VALOR' and t_evaluacion.codigoint=t.evaluacion
		left join tbl_ticket_adicionales tad on t.id=tad.id_ticket
		WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND ( #idGrupo:INTEGER# =0  or s.id_grupo= #idGrupo:INTEGER#)		
		AND ( #idVentanilla:INTEGER# =0  or t.ventanilla_caja= #idVentanilla:INTEGER#)	
		AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)

	UNION
		SELECT t.id,
		CASE WHEN a.descripcion is NULL THEN '--' ELSE a.descripcion END as area,
        CASE WHEN v.nombre is NULL THEN '--' ELSE v.nombre END as nombreVentanilla,
        CASE WHEN user.v_usuario_username is NULL THEN 'CONSULTA' ELSE user.v_usuario_username END as nombreUsuario,
		<!--a.descripcion as area,
		v.nombre as nombreVentanilla,
		user.v_usuario_username as nombreUsuario,-->
		t.codigo,
		t.tipo_identificacion,
		t.numero_identificacion,
		t.descripcion,
		t.fecha_atencion,
		g.nombre as nombreGrupo,
		s.nombre as nombreSubGrupo,
		t.hora_inicio_atencion,
		t.hora_fin_atencion,
		al.descripcion as nombreAlgoritmo,
		t.hora_emision 	as horaTicket,
		TIMEDIFF(if (t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_fin_atencion, t.hora_inicio_atencion), if (t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_inicio_atencion, t.hora_fin_atencion)) as tiempoAtencion,
		TIMEDIFF(if (t.hora_inicio_atencion>t.hora_emision, t.hora_inicio_atencion, t.hora_emision), if (t.hora_inicio_atencion>t.hora_emision, t.hora_emision, t.hora_inicio_atencion)) as tiempoEspera,
		tad.tipo as tipoAnulacion,
		tad.descripcion as descripcionAnulacion,
		t_estado.descripcion as estadoDescripcion,
		t_evaluacion.descripcion as evaluacion
		from tbl_ticket_historico t
		inner join 	tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		left join tbl_ventanilla v on v.id = t.ventanilla_caja
		left join tbl_area a on a.id = v.id_area
		left JOIN ctrl_seg_usuario user ON user.i_usuario_id = t.ventanilla_id_usuario  
		left join tbl_tabla_general t_estado on t_estado.TABLA='ESTADO_TICKET' and t_estado.codigoint=t.estado 
		left join tbl_tabla_general	t_evaluacion on t_evaluacion.TABLA='EVALUACION_VALOR' and t_evaluacion.codigoint=t.evaluacion
		left join tbl_ticket_adicionales tad on t.id=tad.id_ticket
		WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND ( #idGrupo:INTEGER# =0  or s.id_grupo= #idGrupo:INTEGER#)		
		AND ( #idVentanilla:INTEGER# =0  or t.ventanilla_caja= #idVentanilla:INTEGER#)	
		AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
		ORDER BY area ,nombreVentanilla, fecha_atencion, horaTicket
	</select>



	<select id="listarAtencionesXDni" parameterClass="java.util.HashMap" resultMap="getResultTicketXArea">
		SELECT t.id,
		CASE WHEN a.descripcion is NULL THEN '--' ELSE a.descripcion END as area,
        CASE WHEN v.nombre is NULL THEN '--' ELSE v.nombre END as nombreVentanilla,
        CASE WHEN user.v_usuario_username is NULL THEN 'CONSULTA' ELSE user.v_usuario_username END as nombreUsuario,
		<!--a.descripcion as area,
		v.nombre as nombreVentanilla,
		user.v_usuario_username as nombreUsuario,-->
		t.codigo,
		t.tipo_identificacion,
		t.numero_identificacion,
		t.descripcion,
		t.fecha_atencion,
		g.nombre as nombreGrupo,
		s.nombre as nombreSubGrupo,
		t.hora_inicio_atencion,
		t.hora_fin_atencion,
		al.descripcion as nombreAlgoritmo,
		t.hora_emision
		as horaTicket,
		TIMEDIFF(if
		(t.hora_fin_atencion>t.hora_inicio_atencion,
		t.hora_fin_atencion,
		t.hora_inicio_atencion), if
		(t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_inicio_atencion,
		t.hora_fin_atencion)) as tiempoAtencion,
		TIMEDIFF(if
		(t.hora_inicio_atencion>t.hora_emision, t.hora_inicio_atencion,
		t.hora_emision), if (t.hora_inicio_atencion>t.hora_emision,
		t.hora_emision, t.hora_inicio_atencion)) as tiempoEspera,
		tad.tipo as
		tipoAnulacion,
		tad.descripcion as descripcionAnulacion,
		t_estado.descripcion as estadoDescripcion,
		t_evaluacion.descripcion as evaluacion,
		tad.descripcion AS audio
		from tbl_ticket t
		inner join 	tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		LEFT join tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join tbl_area a on a.id = g.id_area
		left join ctrl_seg_usuario user on user.i_usuario_id=t.ventanilla_id_usuario 
		left join tbl_tabla_general t_estado on t_estado.TABLA='ESTADO_TICKET' and t_estado.codigoint=t.estado 
		left join tbl_tabla_general	t_evaluacion on t_evaluacion.TABLA='EVALUACION_VALOR' and t_evaluacion.codigoint=t.evaluacion
		left join tbl_ticket_adicionales tad on t.id=tad.id_ticket
		WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
		and (t.numero_identificacion=#identificacion:STRING#)
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)

UNION
		SELECT t.id,
		CASE WHEN a.descripcion is NULL THEN '--' ELSE a.descripcion END as area,
        CASE WHEN v.nombre is NULL THEN '--' ELSE v.nombre END as nombreVentanilla,
        CASE WHEN user.v_usuario_username is NULL THEN 'CONSULTA' ELSE user.v_usuario_username END as nombreUsuario,
		<!--a.descripcion as area,
		v.nombre as nombreVentanilla,
		user.v_usuario_username as nombreUsuario,-->
		t.codigo,
		t.tipo_identificacion,
		t.numero_identificacion,
		t.descripcion,
		t.fecha_atencion,
		g.nombre as nombreGrupo,
		s.nombre as nombreSubGrupo,
		t.hora_inicio_atencion,
		t.hora_fin_atencion,
		al.descripcion as nombreAlgoritmo,
		t.hora_emision
		as horaTicket,
		TIMEDIFF(if
		(t.hora_fin_atencion>t.hora_inicio_atencion,
		t.hora_fin_atencion,
		t.hora_inicio_atencion), if
		(t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_inicio_atencion,
		t.hora_fin_atencion)) as tiempoAtencion,
		TIMEDIFF(if
		(t.hora_inicio_atencion>t.hora_emision, t.hora_inicio_atencion,
		t.hora_emision), if (t.hora_inicio_atencion>t.hora_emision,
		t.hora_emision, t.hora_inicio_atencion)) as tiempoEspera,
		tad.tipo as
		tipoAnulacion,
		tad.descripcion as descripcionAnulacion,
		t_estado.descripcion as estadoDescripcion,
		t_evaluacion.descripcion as evaluacion,
		tad.descripcion AS audio
		from tbl_ticket_historico t
		inner join 	tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		LEFT join tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join tbl_area a on a.id = g.id_area
		left join ctrl_seg_usuario user on user.i_usuario_id=t.ventanilla_id_usuario 
		left join tbl_tabla_general t_estado on t_estado.TABLA='ESTADO_TICKET' and t_estado.codigoint=t.estado 
		left join tbl_tabla_general	t_evaluacion on t_evaluacion.TABLA='EVALUACION_VALOR' and t_evaluacion.codigoint=t.evaluacion
		left join tbl_ticket_adicionales_historico tad on t.id=tad.id_ticket
		WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
		and (t.numero_identificacion=#identificacion:STRING#)
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
		
		ORDER BY area ,nombreVentanilla, fecha_atencion, horaTicket		
	</select>
	
	<resultMap id="getResultTicketXAlgoritmo"
		class="pe.gob.ep.iclassq.entidad.BeanTicketXAlgoritmo">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="nombreAlgoritmo" property="nombreAlgoritmo"
			jdbcType="VARCHAR" />
		<result column="nombreGrupo" property="nombreGrupo"
			jdbcType="VARCHAR" />
		<result column="fecha_atencion" property="fechaAtencion"
			jdbcType="DATE" />
		<result column="atendidosCantidad" property="atendidosCantidad"
			jdbcType="INTEGER" />
		<result column="derivadosCantidad" property="derivadosCantidad"
			jdbcType="INTEGER" />
		<result column="noatendidosCantidad"
			property="noatendidosCantidad" jdbcType="INTEGER" />
		<result column="anuladosCantidad" property="anuladosCantidad"
			jdbcType="INTEGER" />
		<result column="tpromedioAtencion" property="tpromedioAtencion"
			jdbcType="INTEGER" />
		<result column="tpromedioEspera" property="tpromedioEspera"
			jdbcType="VARCHAR" />
		<result column="evaluacion1" property="evaluacion1"
			jdbcType="INTEGER" />
		<result column="evaluacion2" property="evaluacion2"
			jdbcType="INTEGER" />
		<result column="evaluacion3" property="evaluacion3"
			jdbcType="INTEGER" />
		<result column="evaluacion4" property="evaluacion4"
			jdbcType="INTEGER" />
		<result column="evaluacion5" property="evaluacion5"
			jdbcType="INTEGER" />

	</resultMap>

	<select id="listarAtencionesXAlgoritmo"		parameterClass="java.util.HashMap" resultMap="getResultTicketXAlgoritmo">
		SELECT 1 as id, area, nombreAlgoritmo, nombreGrupo, fecha_atencion, atendidosCantidad, derivadosCantidad, noatendidosCantidad, 
		anuladosCantidad, tpromedioAtencion, tpromedioEspera, evaluacion1, evaluacion2, evaluacion3, evaluacion4, evaluacion5
		from ( 
				SELECT a.descripcion as area,
				al.descripcion as
				nombreAlgoritmo,
				g.nombre as nombreGrupo,
				t.fecha_atencion,
				SUM(CASE WHEN 	t.estado = 60 THEN 1 ELSE 0 END) AS atendidosCantidad,
				SUM(CASE WHEN 	t.estado = 70 THEN 1 ELSE 0 END) AS derivadosCantidad,
				SUM(CASE WHEN 	t.estado = 80 THEN 1 ELSE 0 END) AS noatendidosCantidad,
				SUM(CASE WHEN 	t.estado = 90 THEN 1 ELSE 0 END) AS anuladosCantidad,
				AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion,
				t.hora_fin_atencion)) as tpromedioAtencion,
				AVG(TIMESTAMPDIFF(MINUTE , 	t.hora_emision, t.hora_inicio_atencion)) as tpromedioEspera,
				SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
				SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
				SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
				SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
				SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
				from tbl_ticket_historico as t
				inner join tbl_subgrupo s on s.id = t.id_subgrupo
				inner join tbl_grupo g on g.id = s.id_grupo
				inner join tbl_algoritmo al on al.id = 	g.id_algoritmo
				inner join tbl_ventanilla v on v.id = t.ventanilla_caja
				inner join tbl_area a on a.id = g.id_area
				WHERE ( #idSucursal:INTEGER# = 0 or g.id_sucursal = #idSucursal:INTEGER#)
				AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
				AND (#idAlgoritmo:INTEGER#=0 or g.id_algoritmo = #idAlgoritmo:INTEGER#)				
				AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
				GROUP BY g.id_area , 	g.id_algoritmo, s.id_grupo,t.fecha_atencion
			UNION
				SELECT a.descripcion as area,
				al.descripcion as
				nombreAlgoritmo,
				g.nombre as nombreGrupo,
				t.fecha_atencion,
				SUM(CASE WHEN 	t.estado = 60 THEN 1 ELSE 0 END) AS atendidosCantidad,
				SUM(CASE WHEN 	t.estado = 70 THEN 1 ELSE 0 END) AS derivadosCantidad,
				SUM(CASE WHEN 	t.estado = 80 THEN 1 ELSE 0 END) AS noatendidosCantidad,
				SUM(CASE WHEN 	t.estado = 90 THEN 1 ELSE 0 END) AS anuladosCantidad,
				AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion,
				t.hora_fin_atencion)) as tpromedioAtencion,
				AVG(TIMESTAMPDIFF(MINUTE , 	t.hora_emision, t.hora_inicio_atencion)) as tpromedioEspera,
				SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
				SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
				SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
				SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
				SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
				from tbl_ticket as t
				inner join tbl_subgrupo s on s.id = t.id_subgrupo
				inner join tbl_grupo g on g.id = s.id_grupo
				inner join tbl_algoritmo al on al.id = 	g.id_algoritmo
				inner join tbl_ventanilla v on v.id = t.ventanilla_caja
				inner join tbl_area a on a.id = g.id_area
				WHERE ( #idSucursal:INTEGER# = 0 or g.id_sucursal = #idSucursal:INTEGER#)
				AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
				AND (#idAlgoritmo:INTEGER#=0 or g.id_algoritmo = #idAlgoritmo:INTEGER#)				
				AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
				GROUP BY g.id_area , 	g.id_algoritmo, s.id_grupo,t.fecha_atencion
			) as t_todo
			order by area, nombreAlgoritmo, nombreGrupo, fecha_atencion
	</select>


	<resultMap id="getResultTicketXGrupo" class="pe.gob.ep.iclassq.entidad.BeanTicketXGrupo">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="sucursal" property="sucursal" jdbcType="VARCHAR" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="nombreGrupo" property="nombreGrupo" jdbcType="VARCHAR" />
		<result column="nombreSubGrupo" property="nombreSubGrupo" jdbcType="VARCHAR" />
		<result column="fecha_atencion" property="fechaAtencion" jdbcType="DATE" />
		<result column="atendidosCantidad" property="atendidosCantidad" jdbcType="INTEGER" />
		<result column="derivadosCantidad" property="derivadosCantidad" jdbcType="INTEGER" />
		<result column="noatendidosCantidad" property="noatendidosCantidad" jdbcType="INTEGER" />
		<result column="anuladosCantidad" property="anuladosCantidad" jdbcType="INTEGER" />
		<result column="generadosCantidad" property="generadosCantidad" jdbcType="INTEGER" />
		<result column="canceladosCantidad" property="canceladosCantidad" jdbcType="INTEGER" />
		<result column="ausentesCantidad" property="ausentesCantidad" jdbcType="INTEGER" />
		<result column="maxEsperaGenerados" property="maxEsperaGenerados" jdbcType="VARCHAR" />
		<result column="tpromedioEspera" property="tpromedioEspera" jdbcType="INTEGER" />
		<result column="tpromedioAtencion" property="tpromedioAtencion" jdbcType="INTEGER" />
		<result column="evaluacion1" property="evaluacion1" jdbcType="INTEGER" />
		<result column="evaluacion2" property="evaluacion2" jdbcType="INTEGER" />
		<result column="evaluacion3" property="evaluacion3" jdbcType="INTEGER" />
		<result column="evaluacion4" property="evaluacion4"	jdbcType="INTEGER" />
		<result column="evaluacion5" property="evaluacion5" jdbcType="INTEGER" />
	</resultMap>

	<select id="listarAtencionesXGrupo" parameterClass="java.util.HashMap" resultMap="getResultTicketXGrupo">
			SELECT 1 AS ID, sucursal, area, nombreGrupo, nombreSubGrupo, fecha_atencion, generadosCantidad, atendidosCantidad, derivadosCantidad, noatendidosCantidad, 
			anuladosCantidad, canceladosCantidad, ausentesCantidad, CASE WHEN generadosCantidad = 0 THEN '--' ELSE SEC_TO_TIME(IFNULL(maxEsperaGenerados,0)) END AS maxEsperaGenerados, 
			tpromedioAtencion, tpromedioEspera, evaluacion1, evaluacion2, evaluacion3, evaluacion4, evaluacion5
			FROM (	SELECT t.id,
					su.nombre as sucursal,
					a.descripcion as area,
					g.nombre as nombreGrupo,
					s.nombre as 	nombreSubGrupo,
					t.fecha_atencion,
					SUM(CASE WHEN t.estado = 0 THEN 1 ELSE 0 END) AS generadosCantidad,
					SUM(CASE WHEN t.estado = 60 THEN 1 	ELSE 0 END) AS atendidosCantidad,
					SUM(CASE WHEN t.estado = 70 THEN 1 	ELSE 0 END) AS derivadosCantidad,
					SUM(CASE WHEN t.estado = 80 THEN 1 	ELSE 0 END) AS noatendidosCantidad,
					SUM(CASE WHEN t.estado = 90 THEN 1 	ELSE 0 END) AS anuladosCantidad,
					SUM(CASE WHEN t.estado = 92 THEN 1 	ELSE 0 END) AS canceladosCantidad,
					SUM(CASE WHEN t.estado = 93 THEN 1 	ELSE 0 END) AS ausentesCantidad,
					MAX(CASE WHEN t.estado = 0 THEN
                      TIMESTAMPDIFF(
                        SECOND,
                        TIMESTAMP(t.fecha_atencion, t.hora_emision),
                        COALESCE(
                          TIMESTAMP(t.fecha_atencion, t.hora_inicio_atencion),
                          TIMESTAMP(t.fecha_atencion, t.hora_fin_atencion),
                          NOW()  
                        )
                      )
                    END) AS maxEsperaGenerados,
					AVG(TIMESTAMPDIFF(MINUTE , 	t.hora_inicio_atencion, 	t.hora_fin_atencion)) as tpromedioAtencion,
					AVG(TIMESTAMPDIFF(MINUTE , t.hora_emision, t.hora_inicio_atencion)) as 		tpromedioEspera,
					SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS 	evaluacion1,
					SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS 	evaluacion2,
					SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS 	evaluacion3,
					SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS 	evaluacion4,
					SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS 	evaluacion5
					from tbl_ticket_historico t
					inner join tbl_subgrupo s on s.id = 	t.id_subgrupo
					inner join tbl_grupo g on g.id = s.id_grupo
					inner join 	tbl_algoritmo al on al.id = g.id_algoritmo
					left join tbl_ventanilla v 	on v.id = t.ventanilla_caja
					inner join tbl_area a on a.id = g.id_area
					inner join tbl_sucursal su on su.id = t.id_sucursal 
					WHERE ( #idSucursal:INTEGER# = 0 or g.id_sucursal = #idSucursal:INTEGER#)
					AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
					AND ( #idGrupo:INTEGER# =0  or s.id_grupo= #idGrupo:INTEGER#)
					AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
					GROUP BY a.id , s.id_grupo, t.id_subgrupo, t.fecha_atencion
			UNION
			
					SELECT t.id,
					su.nombre as sucursal,
					a.descripcion as area,
					g.nombre as nombreGrupo,
					s.nombre as 	nombreSubGrupo,
					t.fecha_atencion,
					SUM(CASE WHEN t.estado = 0 THEN 1 ELSE 0 END) AS generadosCantidad,
					SUM(CASE WHEN t.estado = 60 THEN 1 	ELSE 0 END) AS atendidosCantidad,
					SUM(CASE WHEN t.estado = 70 THEN 1 	ELSE 0 END) AS derivadosCantidad,
					SUM(CASE WHEN t.estado = 80 THEN 1 	ELSE 0 END) AS noatendidosCantidad,
					SUM(CASE WHEN t.estado = 90 THEN 1 	ELSE 0 END) AS anuladosCantidad,
					SUM(CASE WHEN t.estado = 92 THEN 1 	ELSE 0 END) AS canceladosCantidad,
					SUM(CASE WHEN t.estado = 93 THEN 1 	ELSE 0 END) AS ausentesCantidad,
					MAX(CASE WHEN t.estado = 0 THEN
                      TIMESTAMPDIFF(
                        SECOND,
                        TIMESTAMP(t.fecha_atencion, t.hora_emision),
                        NOW()
                      )
                    END) AS maxEsperaGenerados,
					AVG(TIMESTAMPDIFF(MINUTE , 	t.hora_inicio_atencion, 	t.hora_fin_atencion)) as tpromedioAtencion,
					AVG(TIMESTAMPDIFF(MINUTE , t.hora_emision, t.hora_inicio_atencion)) as 		tpromedioEspera,
					SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS 	evaluacion1,
					SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS 	evaluacion2,
					SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS 	evaluacion3,
					SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS 	evaluacion4,
					SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS 	evaluacion5
					from tbl_ticket t
					inner join tbl_subgrupo s on s.id = 	t.id_subgrupo
					inner join tbl_grupo g on g.id = s.id_grupo
					inner join 	tbl_algoritmo al on al.id = g.id_algoritmo
					left join tbl_ventanilla v 	on v.id = t.ventanilla_caja
					inner join tbl_area a on a.id = g.id_area
					inner join tbl_sucursal su on su.id = t.id_sucursal 
					WHERE ( #idSucursal:INTEGER# = 0 or g.id_sucursal = #idSucursal:INTEGER#)
					AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
					AND ( #idGrupo:INTEGER# =0  or s.id_grupo= #idGrupo:INTEGER#)
					AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
					GROUP BY a.id , s.id_grupo, t.id_subgrupo, t.fecha_atencion
				) AS GT_GLOBAL
				ORDER BY sucursal, area, nombreGrupo, nombreSubGrupo, fecha_atencion	
		</select>
	<resultMap id="getResultTicketXUsuario"
		class="pe.gob.ep.iclassq.entidad.BeanTicketXUsuario">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="sucursal" property="sucursal" jdbcType="VARCHAR" />
		<result column="usuario" property="usuario" jdbcType="VARCHAR" />
		<result column="fecha_atencion" property="fechaAtencion" jdbcType="DATE" />
		<result column="atendidosCantidad" property="atendidosCantidad" jdbcType="INTEGER" />
		<result column="derivadosCantidad" property="derivadosCantidad" jdbcType="INTEGER" />
		<result column="noatendidosCantidad" property="noatendidosCantidad" jdbcType="INTEGER" />
		<result column="anuladosCantidad" property="anuladosCantidad" jdbcType="INTEGER" />
		<result column="canceladosCantidad" property="canceladosCantidad" jdbcType="INTEGER" />
		<result column="ausentesCantidad" property="ausentesCantidad" jdbcType="INTEGER" />
		<result column="tpromedioEspera" property="tpromedioEspera" jdbcType="INTEGER" />
		<result column="tpromedioAtencion" property="tpromedioAtencion" jdbcType="INTEGER" />
		<result column="evaluacion1" property="evaluacion1" jdbcType="INTEGER" />
		<result column="evaluacion2" property="evaluacion2" jdbcType="INTEGER" />
		<result column="evaluacion3" property="evaluacion3" jdbcType="INTEGER" />
		<result column="evaluacion4" property="evaluacion4" jdbcType="INTEGER" />
		<result column="evaluacion5" property="evaluacion5" jdbcType="INTEGER" />
	</resultMap>
	<select id="listarAtencionesXUsuario"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXUsuario">
			SELECT 1 AS ID, sucursal, usuario, fecha_atencion, atendidosCantidad, derivadosCantidad, noatendidosCantidad, 
			anuladosCantidad, canceladosCantidad, ausentesCantidad, tpromedioAtencion, tpromedioEspera, evaluacion1, evaluacion2, evaluacion3, evaluacion4, evaluacion5
			FROM (	SELECT u.V_USUARIO_USERNAME as usuario,
					su.nombre as sucursal,
					t.fecha_atencion,
					SUM(CASE WHEN t.estado = 60 THEN 1 ELSE 0 END) AS atendidosCantidad,
					SUM(CASE WHEN t.estado = 70 THEN 1 ELSE 0 END) AS derivadosCantidad,
					SUM(CASE WHEN t.estado = 80 THEN 1 ELSE 0 END) AS noatendidosCantidad,
					SUM(CASE WHEN t.estado = 90 THEN 1 ELSE 0 END) AS anuladosCantidad,
					SUM(CASE WHEN t.estado = 92 THEN 1 ELSE 0 END) AS canceladosCantidad,
					SUM(CASE WHEN t.estado = 93 THEN 1 ELSE 0 END) AS ausentesCantidad,
					AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion,t.hora_fin_atencion)) as tpromedioAtencion,
					AVG(TIMESTAMPDIFF(MINUTE , t.hora_emision, t.hora_inicio_atencion)) as 	tpromedioEspera,
					SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
					SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
					SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
					SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
					SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
					from 	tbl_ticket_historico t
					inner join tbl_subgrupo s on s.id = t.id_subgrupo
					inner join tbl_grupo g on g.id = s.id_grupo
					inner join tbl_algoritmo al on al.id = g.id_algoritmo
					inner join tbl_ventanilla v on v.id = t.ventanilla_caja
					inner join ctrl_seg_usuario u on u.I_USUARIO_ID =t.ventanilla_id_usuario
					inner join tbl_area a on a.id = g.id_area
					inner join tbl_sucursal su on su.id = t.id_sucursal
					WHERE ( #idSucursal:INTEGER#= 0 or g.id_sucursal = #idSucursal:INTEGER#)
					AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
					AND ( #idUsuario:INTEGER# =0  or t.ventanilla_id_usuario= #idUsuario:INTEGER#)
					AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)		
					GROUP BY t.ventanilla_id_usuario, t.fecha_atencion
			
			UNION
			
			SELECT 	u.V_USUARIO_USERNAME as usuario,
					su.nombre as sucursal,
					t.fecha_atencion,
					SUM(CASE WHEN t.estado = 60 THEN 1 ELSE 0 END) AS atendidosCantidad,
					SUM(CASE WHEN t.estado = 70 THEN 1 ELSE 0 END) AS derivadosCantidad,
					SUM(CASE WHEN t.estado = 80 THEN 1 ELSE 0 END) AS noatendidosCantidad,
					SUM(CASE WHEN t.estado = 90 THEN 1 ELSE 0 END) AS anuladosCantidad,
					SUM(CASE WHEN t.estado = 92 THEN 1 ELSE 0 END) AS canceladosCantidad,
					SUM(CASE WHEN t.estado = 93 THEN 1 ELSE 0 END) AS ausentesCantidad,
					AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion,t.hora_fin_atencion)) as tpromedioAtencion,
					AVG(TIMESTAMPDIFF(MINUTE , t.hora_emision, t.hora_inicio_atencion)) as 	tpromedioEspera,
					SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
					SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
					SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
					SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
					SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
					from 	tbl_ticket t
					inner join tbl_subgrupo s on s.id = t.id_subgrupo
					inner join tbl_grupo g on g.id = s.id_grupo
					inner join tbl_algoritmo al on al.id = g.id_algoritmo
					inner join tbl_ventanilla v on v.id = t.ventanilla_caja
					inner join ctrl_seg_usuario u on u.I_USUARIO_ID =t.ventanilla_id_usuario
					inner join tbl_area a on a.id = g.id_area
					inner join tbl_sucursal su on su.id = t.id_sucursal
					WHERE ( #idSucursal:INTEGER#= 0 or g.id_sucursal = #idSucursal:INTEGER#)
					AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
					AND ( #idUsuario:INTEGER# =0  or t.ventanilla_id_usuario= #idUsuario:INTEGER#)
					AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)		
					GROUP BY t.ventanilla_id_usuario, t.fecha_atencion
			) AS UT_GLOBAL
			ORDER BY usuario, fecha_atencion
	</select>

	<resultMap id="getResultTicketXMesUsuario"
		class="pe.gob.ep.iclassq.entidad.BeanTicketXMesUsuario">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="usuario" property="usuario" jdbcType="VARCHAR" />
		<result column="periodo" property="periodo" jdbcType="DATE" />
		<result column="atendidosCantidad" property="atendidosCantidad"
			jdbcType="INTEGER" />
		<result column="derivadosCantidad" property="derivadosCantidad"
			jdbcType="INTEGER" />
		<result column="noatendidosCantidad"
			property="noatendidosCantidad" jdbcType="INTEGER" />
		<result column="anuladosCantidad" property="anuladosCantidad"
			jdbcType="INTEGER" />
		<result column="tpromedioEspera" property="tpromedioEspera"
			jdbcType="INTEGER" />
		<result column="tpromedioAtencion" property="tpromedioAtencion"
			jdbcType="INTEGER" />
		<result column="evaluacion1" property="evaluacion1"
			jdbcType="INTEGER" />
		<result column="evaluacion2" property="evaluacion2"
			jdbcType="INTEGER" />
		<result column="evaluacion3" property="evaluacion3"
			jdbcType="INTEGER" />
		<result column="evaluacion4" property="evaluacion4"
			jdbcType="INTEGER" />
		<result column="evaluacion5" property="evaluacion5"
			jdbcType="INTEGER" />
	</resultMap>

	<select id="listarAtencionesXMesUsuario" 	parameterClass="java.util.HashMap" 	resultMap="getResultTicketXMesUsuario">
SELECT 1 AS ID, periodo,area, usuario,  atendidosCantidad, derivadosCantidad, noatendidosCantidad, 
anuladosCantidad, tpromedioAtencion, tpromedioEspera, evaluacion1, evaluacion2, evaluacion3, evaluacion4, evaluacion5
FROM (SELECT 	DATE_FORMAT(t.fecha_atencion, "%Y-%m") as 	periodo,
		a.descripcion as area,
		u.V_USUARIO_USERNAME as usuario,
		SUM(CASE WHEN t.estado = 60 THEN 1 	ELSE 0 END) AS atendidosCantidad,
		SUM(CASE WHEN t.estado = 70 THEN 1 	ELSE 0 END) AS derivadosCantidad,
		SUM(CASE WHEN t.estado = 80 THEN 1 	ELSE 0 END) AS noatendidosCantidad,
		SUM(CASE WHEN t.estado = 90 THEN 1 	ELSE 0 END) AS anuladosCantidad,
		AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion, 	t.hora_fin_atencion)) as tpromedioAtencion,
		AVG(TIMESTAMPDIFF(MINUTE , 	t.hora_emision, t.hora_inicio_atencion)) as tpromedioEspera,
		SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
		SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
		SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
		SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
		SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
		from tbl_ticket_historico t
		inner join tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		inner join tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join ctrl_seg_usuario u on u.I_USUARIO_ID = t.ventanilla_id_usuario
		inner join tbl_area a on a.id = g.id_area
		WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND ( #idUsuario:INTEGER# =0  or t.ventanilla_id_usuario= #idUsuario:INTEGER#)
		AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
		GROUP BY periodo, g.id_area, t.ventanilla_id_usuario
	UNION
		SELECT 	DATE_FORMAT(t.fecha_atencion, "%Y-%m") as 	periodo,
		a.descripcion as area,
		u.V_USUARIO_USERNAME as usuario,
		SUM(CASE WHEN t.estado = 60 THEN 1 	ELSE 0 END) AS atendidosCantidad,
		SUM(CASE WHEN t.estado = 70 THEN 1 	ELSE 0 END) AS derivadosCantidad,
		SUM(CASE WHEN t.estado = 80 THEN 1 	ELSE 0 END) AS noatendidosCantidad,
		SUM(CASE WHEN t.estado = 90 THEN 1 	ELSE 0 END) AS anuladosCantidad,
		AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion, 	t.hora_fin_atencion)) as tpromedioAtencion,
		AVG(TIMESTAMPDIFF(MINUTE , 	t.hora_emision, t.hora_inicio_atencion)) as tpromedioEspera,
		SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
		SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
		SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
		SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
		SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
		from tbl_ticket t
		inner join tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		inner join tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join ctrl_seg_usuario u on u.I_USUARIO_ID = t.ventanilla_id_usuario
		inner join tbl_area a on a.id = g.id_area
		WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND ( #idUsuario:INTEGER# =0  or t.ventanilla_id_usuario= #idUsuario:INTEGER#)
		AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
		GROUP BY periodo, g.id_area, t.ventanilla_id_usuario) AS UMT_GLOBAL
	ORDER BY periodo,area, usuario
	</select>
	<resultMap id="getResultTicketXMesGrupo"
		class="pe.gob.ep.iclassq.entidad.BeanTicketXMesGrupo">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="periodo" property="periodo" jdbcType="DATE" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="nombreGrupo" property="nombreGrupo" jdbcType="VARCHAR" />
		<result column="atendidosCantidad" property="atendidosCantidad" jdbcType="INTEGER" />
		<result column="derivadosCantidad" property="derivadosCantidad" jdbcType="INTEGER" />
		<result column="noatendidosCantidad" property="noatendidosCantidad" jdbcType="INTEGER" />
		<result column="anuladosCantidad" property="anuladosCantidad" jdbcType="INTEGER" />
		<result column="tpromedioEspera" property="tpromedioEspera" jdbcType="INTEGER" />
		<result column="tpromedioAtencion" property="tpromedioAtencion" jdbcType="INTEGER" />
		<result column="evaluacion1" property="evaluacion1" jdbcType="INTEGER" />
		<result column="evaluacion2" property="evaluacion2" jdbcType="INTEGER" />
		<result column="evaluacion3" property="evaluacion3"	jdbcType="INTEGER" />
		<result column="evaluacion4" property="evaluacion4" jdbcType="INTEGER" />
		<result column="evaluacion5" property="evaluacion5" jdbcType="INTEGER" />	
	</resultMap>

	<select id="listarAtencionesXMesGrupo" 	parameterClass="java.util.HashMap" 	resultMap="getResultTicketXMesGrupo">
		SELECT 1 AS ID, periodo,area, nombreGrupo,  atendidosCantidad, derivadosCantidad, noatendidosCantidad, 
		anuladosCantidad, tpromedioAtencion, tpromedioEspera, evaluacion1, evaluacion2, evaluacion3, evaluacion4, evaluacion5
		FROM ( SELECT a.descripcion as area,
				g.nombre as nombreGrupo,
				DATE_FORMAT(t.fecha_atencion,"%Y-%m") as periodo,
				SUM(CASE WHEN t.estado = 60 THEN 1 ELSE 0 END) AS atendidosCantidad,
				SUM(CASE WHEN t.estado = 70 THEN 1 ELSE 0 END) AS derivadosCantidad,
				SUM(CASE WHEN t.estado = 80 THEN 1 ELSE 0 END) AS noatendidosCantidad,
				SUM(CASE WHEN 	t.estado = 90 THEN 1 ELSE 0 END) AS anuladosCantidad,
				AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion, t.hora_fin_atencion)) as tpromedioAtencion, 
				AVG(TIMESTAMPDIFF(MINUTE , t.hora_emision, t.hora_inicio_atencion)) as tpromedioEspera,
				SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
				SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
				SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
				SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
				SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
				from tbl_ticket_historico t
				inner join tbl_subgrupo s on s.id = t.id_subgrupo
				inner join tbl_grupo g on g.id = s.id_grupo
				inner join tbl_ventanilla v on v.id = t.ventanilla_caja
				inner join tbl_area a on a.id = g.id_area
				WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
				AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
				AND ( #idGrupo:INTEGER# =0  or s.id_grupo= #idGrupo:INTEGER#)
				AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
				GROUP BY periodo, g.id_area, s.id_grupo
			UNION
				SELECT a.descripcion as area,
				g.nombre as nombreGrupo,
				DATE_FORMAT(t.fecha_atencion,"%Y-%m") as periodo,
				SUM(CASE WHEN t.estado = 60 THEN 1 ELSE 0 END) AS atendidosCantidad,
				SUM(CASE WHEN t.estado = 70 THEN 1 ELSE 0 END) AS derivadosCantidad,
				SUM(CASE WHEN t.estado = 80 THEN 1 ELSE 0 END) AS noatendidosCantidad,
				SUM(CASE WHEN 	t.estado = 90 THEN 1 ELSE 0 END) AS anuladosCantidad,
				AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion, t.hora_fin_atencion)) as tpromedioAtencion, 
				AVG(TIMESTAMPDIFF(MINUTE , t.hora_emision, t.hora_inicio_atencion)) as tpromedioEspera,
				SUM(CASE WHEN t.evaluacion = 1 THEN 1 ELSE 0 END) AS evaluacion1,
				SUM(CASE WHEN t.evaluacion = 2 THEN 1 ELSE 0 END) AS evaluacion2,
				SUM(CASE WHEN t.evaluacion = 3 THEN 1 ELSE 0 END) AS evaluacion3,
				SUM(CASE WHEN t.evaluacion = 4 THEN 1 ELSE 0 END) AS evaluacion4,
				SUM(CASE WHEN t.evaluacion = 5 THEN 1 ELSE 0 END) AS evaluacion5
				from tbl_ticket t
				inner join tbl_subgrupo s on s.id = t.id_subgrupo
				inner join tbl_grupo g on g.id = s.id_grupo
				inner join tbl_ventanilla v on v.id = t.ventanilla_caja
				inner join tbl_area a on a.id = g.id_area
				WHERE ( g.id_sucursal = #idSucursal:INTEGER#)
				AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
				AND ( #idGrupo:INTEGER# =0  or s.id_grupo= #idGrupo:INTEGER#)
				AND (t.fecha_atencion BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
				GROUP BY periodo, g.id_area, s.id_grupo) AS GMT_GLOBAL
			
			ORDER BY periodo,area, nombreGrupo;
	</select>


	<resultMap id="getResultTicketXMesArea"
		class="pe.gob.ep.iclassq.entidad.BeanTicketXMesArea">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="area" property="area" jdbcType="VARCHAR" />
		<result column="periodo" property="periodo" jdbcType="DATE" />
		<result column="aCantidad" property="aCantidad"
			jdbcType="INTEGER" />
		<result column="dCantidad" property="dCantidad"
			jdbcType="INTEGER" />
		<result column="nCantidad" property="nCantidad"
			jdbcType="INTEGER" />
		<result column="tPromedio" property="tPromedio"
			jdbcType="VARCHAR" />
		<result column="evaluacionMin" property="evaluacionMin"
			jdbcType="INTEGER" />
		<result column="evaluacionMen" property="evaluacionMen"
			jdbcType="INTEGER" />
		<result column="evaluacionNor" property="evaluacionNor"
			jdbcType="INTEGER" />
		<result column="evaluacionMay" property="evaluacionMay"
			jdbcType="INTEGER" />
		<result column="evaluacionMax" property="evaluacionMax"
			jdbcType="INTEGER" />

	</resultMap>

	<select id="listarAtencionesXMesArea"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXMesArea">
		SELECT t.id,
		a.descripcion as area,
		DATE_FORMAT(t.fecha_atencion, "%Y-%m") as
		periodo,
		SUM(CASE WHEN t.estado = 60 THEN 1
		ELSE 0 END) AS aCantidad,
		SUM(CASE WHEN t.estado = 70 THEN 1
		ELSE 0 END) AS dCantidad,
		SUM(CASE
		WHEN t.estado = 80 THEN 1
		ELSE 0 END) AS nCantidad,
		AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion,
		t.hora_fin_atencion)) as tPromedio,
		SUM(CASE WHEN t.evaluacion = 1 THEN
		1 ELSE 0 END) AS evaluacionMin,
		SUM(CASE WHEN t.evaluacion = 2 THEN 1
		ELSE 0 END) AS evaluacionMen,
		SUM(CASE WHEN t.evaluacion = 3 THEN 1
		ELSE 0 END) AS evaluacionNor,
		SUM(CASE WHEN t.evaluacion = 4 THEN 1
		ELSE 0 END) AS evaluacionMay,
		SUM(CASE WHEN t.evaluacion = 5 THEN 1
		ELSE 0 END) AS evaluacionMax
		from tbl_ticket_historico t
		inner join tbl_subgrupo s
		on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		inner join
		tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join tbl_area a on
		a.id = v.id_area
		WHERE a.id= #idArea:INTEGER#
		AND (t.fecha_atencion
		BETWEEN #fechaInicio:DATE# and #fechaFin:DATE#)
		GROUP BY v.id_area
	</select>

	<select id="listarAtencionesComparativo"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXMesArea">
		SELECT t.id,
		a.descripcion as area,
		DATE_FORMAT(t.fecha_atencion, "%Y-%m") as
		periodo,
		SUM(CASE WHEN t.estado = 60 THEN 1
		ELSE 0 END) AS aCantidad,
		SUM(CASE WHEN t.estado = 70 THEN 1
		ELSE 0 END) AS dCantidad,
		SUM(CASE
		WHEN t.estado = 80 THEN 1
		ELSE 0 END) AS nCantidad,
		AVG(TIMESTAMPDIFF(MINUTE , t.hora_inicio_atencion,
		t.hora_fin_atencion)) as tPromedio,
		SUM(CASE WHEN t.evaluacion = 1 THEN
		1 ELSE 0 END) AS evaluacionMin,
		SUM(CASE WHEN t.evaluacion = 2 THEN 1
		ELSE 0 END) AS evaluacionMen,
		SUM(CASE WHEN t.evaluacion = 3 THEN 1
		ELSE 0 END) AS evaluacionNor,
		SUM(CASE WHEN t.evaluacion = 4 THEN 1
		ELSE 0 END) AS evaluacionMay,
		SUM(CASE WHEN t.evaluacion = 5 THEN 1
		ELSE 0 END) AS evaluacionMax
		from tbl_ticket_historico t
		inner join tbl_subgrupo s
		on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		inner join
		tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join tbl_area a on
		a.id = v.id_area
		WHERE a.id= #idArea1:INTEGER# OR
		a.id=
		#idArea2:INTEGER#
		AND (t.fecha_atencion BETWEEN
		#fechaInicio:DATE# and
		#fechaFin:DATE#)
		GROUP BY v.id_area, periodo
	</select>


	<select id="listarTicketSecuencial"
		parameterClass="java.util.HashMap"
		resultMap="ibatorgenerated_BaseResultMap">
		SELECT TK.ID, TK.CODIGO, TK.TIPO_IDENTIFICACION,
		TK.NUMERO_IDENTIFICACION,
		TK.HORA_EMISION,
		TK.fecha_hora_prog_alg_2_tiempo,
		TK.fecha_hora_prog_alg_2_tiempo AS
		HORA_ATENCION_1_2,
		TK.hora_inicio_atencion, TK.hora_fin_atencion,
		TK.id_subgrupo,
		TK.estado, TK.secuencia_algo_3_proporcion,
		TK.id_ticket_derivado,
		TK.nombre_subgrupo, TK.prefijo,
		TK.id_ventanilla_derivacion,
		TK.activa_audio_texto,
		TK.tipo_identificacion,
		TK.numero_identificacion, TK.descripcion,
		TK.ventanilla_id_usuario,
		TK.ticket_secuencia, TK.envia_audio,
		TK.ventanilla_caja, TK.evaluacion, TK.fecha_atencion
		FROM TBL_TICKET TK
		LEFT JOIN
		TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
		LEFT JOIN
		TBL_GRUPO GRG ON
		GRG.ID=SGRG.ID_GRUPO
		WHERE
		Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')=
		Date_format(now(),'%Y/%M/%d') AND TK.ESTADO=0
		AND GRG.ID_ALGORITMO IN
		(1,2)
		AND (TK.ID_VENTANILLA_DERIVACION=0
		OR TK.ID_VENTANILLA_DERIVACION
		IN (SELECT USV.I_VENTANILLA FROM
		ctrl_seg_usuario USV WHERE
		USV.I_USUARIO_ID=#ventanillaIdUsuario:INTEGER#)
		)
		AND TK.ID_SUBGRUPO IN
		(SELECT SGR.ID
		FROM TBL_SUBGRUPO SGR , TBL_GRUPO GR ,
		TBL_ROL_EQUIPO_GRUPO REG, TBL_ROL_EQUIPO RE, ctrl_seg_usuario USU
		WHERE GR.ID=SGR.ID_GRUPO
		AND REG.ID_GRUPO=GR.ID
		AND
		RE.ID=REG.ID_ROL_EQUIPO AND RE.TIPO_EQUIPO='V'
		AND
		USU.i_rol_equipo=RE.ID AND
		USU.I_USUARIO_ID=#ventanillaIdUsuario:INTEGER#)
		ORDER BY
		HORA_ATENCION_1_2 ASC
		LIMIT 1
	</select>

	<!-- Victor Querys Adicionales -->

	<resultMap id="getTicketId"
		class="pe.gob.ep.iclassq.entidad.BeanTicketId">
		<result column="id" property="id" jdbcType="INTEGER" />
	</resultMap>
	
	<resultMap id="getTicketIdSonido"
		class="pe.gob.ep.iclassq.entidad.BeanTicketIdSonido">
		<result column="id" property="id" jdbcType="INTEGER" />
	</resultMap>


	<select id="getCantidadTicketEst30_Alg3"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(tk.id)
		from tbl_ticket tk
		where date_format(tk.fecha_atencion, '%y/%m/%d') =
		date_format(now(),'%y/%m/%d') and tk.estado=30
		and tk.id_subgrupo in
		(select sgr.id from tbl_subgrupo sgr where
		sgr.id_grupo=
		#idGrupo:INTEGER#)

	</select>


	<select id="getMaximaSecuencia31_Alg3"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select
		max(tk.secuencia_algo_3_proporcion)
		from tbl_ticket tk
		where
		date_format(tk.fecha_atencion, '%y/%m/%d') =
		date_format(now(),'%y/%m/%d') and tk.estado=31
		and tk.id_subgrupo in
		(select sgr.id from tbl_subgrupo sgr where sgr.id_grupo=
		#idGrupo:INTEGER#)

	</select>

	<select id="getCantidadTicketGrupoEst31_Alg3"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		select count(tk.id)
		from tbl_ticket tk
		where date_format(tk.fecha_atencion, "%y/%m/%d")=
		date_format(now(),
		"%y/%m/%d") and tk.estado = 31
		and tk.id_subgrupo in
		(select sgr.id
		from tbl_subgrupo sgr where sgr.id_grupo=
		#idGrupo:INTEGER#)
	</select>
	<select id="getNextTicketSubGrupoEst30_Alg3"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
		select (tk.id)
		from
		tbl_ticket tk
		where date_format(tk.fecha_atencion, '%y/%m/%d')=
		date_format(now(),'%y/%m/%d') and tk.estado=30
		and tk.id_subgrupo =
		#idSubGrupo:INTEGER#
		order by tk.hora_emision asc
		limit 1
	</select>

	<select id="getNextTicketGrupoEst31_Alg3"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
		SELECT TK.ID
		FROM
		TBL_TICKET TK
		inner JOIN TBL_SUBGRUPO SGRG ON
		SGRG.ID=TK.ID_SUBGRUPO
		inner JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
		WHERE
		Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')=
		Date_format(now(),'%Y/%M/%d') AND TK.ESTADO=31
		AND
		(TK.ID_VENTANILLA_DERIVACION=0
		OR TK.ID_VENTANILLA_DERIVACION IN
		(SELECT USV.I_VENTANILLA FROM
		ctrl_seg_usuario USV WHERE
		USV.I_USUARIO_ID=#idUsuario:INTEGER#)
		)
		AND
		TK.ID_SUBGRUPO IN (select
		sgr.id from tbl_subgrupo sgr where
		sgr.id_grupo= #idGrupo:INTEGER#)
		ORDER BY
		tk.secuencia_algo_3_proporcion asc
		limit 1
	</select>
	<!-- CAMBIO VBR 20191124VBR -->

	<select id="getNextTicketGrupo_Alg_1_2"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
		SELECT TK.ID
		FROM
		TBL_TICKET TK
		inner JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
		inner JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
		
		WHERE 	Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d') AND TK.ESTADO=0
		AND GRG.ID_ALGORITMO IN (1,2)
		AND (TK.ID_VENTANILLA_DERIVACION=0 OR TK.ID_VENTANILLA_DERIVACION IN
								(SELECT USV.I_VENTANILLA FROM
								ctrl_seg_usuario USV WHERE
								USV.I_USUARIO_ID=#idUsuario:INTEGER#)
								)
		AND 	GRG.ID_ALGORITMO IN (1,2)
		AND 	TK.ID_SUBGRUPO IN ( SELECT 	SGR1.ID
				FROM TBL_SUBGRUPO SGR1 , TBL_GRUPO GR1 , TBL_ROL_EQUIPO_GRUPO
				REG1, 	TBL_ROL_EQUIPO RE1, ctrl_seg_usuario USU1
				WHERE 	GR1.ID=SGR1.ID_GRUPO AND REG1.ID_GRUPO=GR1.ID
				AND      GR1.id_algoritmo IN(1,2)
				AND 	RE1.ID=REG1.ID_ROL_EQUIPO AND RE1.TIPO_EQUIPO='V'
				AND 	USU1.i_rol_equipo=RE1.ID AND USU1.I_USUARIO_ID=#idUsuario:INTEGER#)
		ORDER BY tk.fecha_hora_prog_alg_2_tiempo asc
		LIMIT 1
		
	</select>
	
	<select id="getNextTicketSubGrupo_Alg_1_2_VS"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
		SELECT TK.ID
		FROM
		TBL_TICKET TK
		inner JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
		inner JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
		WHERE 
			Date_format(TK.FECHA_ATENCION, '%Y/%M/%d') = Date_format(now(),'%Y/%M/%d') 
			AND TK.ESTADO=0
			AND TK.ID_SUCURSAL = #idSucursal:INTEGER#
			AND GRG.ID_ALGORITMO IN (1,2)
			AND (TK.ID_VENTANILLA_DERIVACION = 0 
				OR (TK.ID_VENTANILLA_DERIVACION != 0 
					AND TK.ID_VENTANILLA_DERIVACION IN (
						SELECT USV.I_VENTANILLA FROM
						ctrl_seg_usuario USV WHERE
						USV.I_USUARIO_ID=#idUsuario:INTEGER#
					)
				)
			)
			AND	TK.ID_SUBGRUPO IN (
				SELECT reg1.id_subgrupo
				FROM tbl_rol_equipo_subgrupo REG1, TBL_ROL_EQUIPO RE1
				WHERE RE1.id = #idRolEquipo#
				AND RE1.ID=REG1.ID_ROL_EQUIPO AND RE1.TIPO_EQUIPO='VS'
			)
			AND NOT EXISTS (
			    SELECT 1 FROM TBL_TICKET_DERIVACION TD
			    INNER JOIN TBL_TICKET T_ORIGEN ON T_ORIGEN.ID = TD.ID_TICKET_ORIGEN
			    WHERE TD.ID_TICKET_DERIVADO = TK.ID
			    AND T_ORIGEN.VENTANILLA_ID_USUARIO = #idUsuario:INTEGER#
			    AND DATE(T_ORIGEN.FECHA_ATENCION) = CURDATE()
			)
		ORDER BY tk.fecha_hora_prog_alg_2_tiempo asc
		LIMIT 1
	</select>
	
	<select id="getNextTicketSubGrupo_Alg_1_2_VA"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
		SELECT TK.ID
		FROM
		TBL_TICKET TK
		inner JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
		inner JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
		WHERE 
			Date_format(TK.FECHA_ATENCION, '%Y/%M/%d') = Date_format(now(),'%Y/%M/%d') 
			AND TK.ESTADO=0
			AND TK.ID_SUCURSAL = #idSucursal:INTEGER#
			AND GRG.ID_ALGORITMO IN (1,2)
			AND (TK.ID_VENTANILLA_DERIVACION = 0 
				OR (TK.ID_VENTANILLA_DERIVACION != 0 
					AND TK.ID_VENTANILLA_DERIVACION IN (
						SELECT USV.I_VENTANILLA FROM
						ctrl_seg_usuario USV WHERE
						USV.I_USUARIO_ID=#idUsuario:INTEGER#
					)
				)
			)
			AND	TK.ID_SUBGRUPO IN (
				SELECT reg1.id_subgrupo
				FROM tbl_rol_equipo_subgrupo REG1, TBL_ROL_EQUIPO RE1
				WHERE RE1.id = #idRolEquipo#
				AND RE1.ID=REG1.ID_ROL_EQUIPO AND RE1.TIPO_EQUIPO='VA'
			)
			AND NOT EXISTS (
			    SELECT 1 FROM TBL_TICKET_DERIVACION TD
			    INNER JOIN TBL_TICKET T_ORIGEN ON T_ORIGEN.ID = TD.ID_TICKET_ORIGEN
			    WHERE TD.ID_TICKET_DERIVADO = TK.ID
			    AND T_ORIGEN.VENTANILLA_ID_USUARIO = #idUsuario:INTEGER#
			    AND DATE(T_ORIGEN.FECHA_ATENCION) = CURDATE()
			)
		ORDER BY tk.fecha_hora_prog_alg_2_tiempo asc
		LIMIT 1
	</select>
	
	<select id="getNextTicketSubGrupo_Alg_1_2"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
<!-- 		SELECT TK.ID -->
<!-- 		FROM -->
<!-- 		TBL_TICKET TK -->
<!-- 		inner JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO -->
<!-- 		inner JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO -->
		
<!-- 		WHERE 	Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d') AND TK.ESTADO=0 -->
<!-- 		AND TK.ID_SUCURSAL = #idSucursal:INTEGER# -->
<!-- 		AND GRG.ID_ALGORITMO IN (1,2) -->
<!-- 		AND (TK.ID_VENTANILLA_DERIVACION=0 OR TK.ID_VENTANILLA_DERIVACION IN -->
<!-- 								(SELECT USV.I_VENTANILLA FROM -->
<!-- 								ctrl_seg_usuario USV WHERE -->
<!-- 								USV.I_USUARIO_ID=#idUsuario:INTEGER#) -->
<!-- 								) -->
<!-- 		AND 	GRG.ID_ALGORITMO IN (1,2) -->
<!-- 		AND		TK.ID_SUBGRUPO IN (SELECT A.ID_SUBGRUPO  -->
<!-- 								   FROM TBL_ROL_EQUIPO_SUBGRUPO A -->
<!-- 								   WHERE A.ID_ROL_EQUIPO = #idRolEquipo:INTEGER# -->
<!-- 								   AND A.PROPORCION IN (SELECT B.PROPORCION -->
<!-- 								   					  FROM TBL_ROL_EQUIPO_SUBGRUPO B -->
<!-- 								   					  WHERE B.ID_ROL_EQUIPO = #idRolEquipo:INTEGER# -->
<!-- 								   					  AND B.ID_SUBGRUPO = #idSubGrupo:INTEGER#)  -->
<!-- 								   ) -->
<!-- 		ORDER BY tk.fecha_hora_prog_alg_2_tiempo asc -->
<!-- 		LIMIT 1 -->
		<![CDATA[
			SELECT TK.ID
			FROM TBL_TICKET TK
			INNER JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
			INNER JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
			WHERE Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d') 
			AND TK.ESTADO=0
			AND TK.ID_SUCURSAL = #idSucursal:INTEGER#
			AND GRG.ID_ALGORITMO IN (1,2)
			AND (TK.ID_VENTANILLA_DERIVACION=0 OR TK.ID_VENTANILLA_DERIVACION IN
									(SELECT USV.I_VENTANILLA FROM
									ctrl_seg_usuario USV WHERE
									USV.I_USUARIO_ID=#idUsuario:INTEGER#)
									)
			AND TK.ID_SUBGRUPO IN (SELECT A.ID_SUBGRUPO 
									   FROM TBL_ROL_EQUIPO_SUBGRUPO A
									   WHERE A.ID_ROL_EQUIPO = #idRolEquipo:INTEGER#
									   AND A.PROPORCION IN (SELECT B.PROPORCION
									   					  FROM TBL_ROL_EQUIPO_SUBGRUPO B
									   					  WHERE B.ID_ROL_EQUIPO = #idRolEquipo:INTEGER#
									   					  AND B.ID_SUBGRUPO = #idSubGrupo:INTEGER#) 
									   )
			AND NOT EXISTS (
			    SELECT 1 FROM TBL_TICKET_DERIVACION TD
			    INNER JOIN TBL_TICKET T_ORIGEN ON T_ORIGEN.ID = TD.ID_TICKET_ORIGEN
			    WHERE TD.ID_TICKET_DERIVADO = TK.ID
			    AND T_ORIGEN.VENTANILLA_ID_USUARIO = #idUsuario:INTEGER#
			    AND DATE(T_ORIGEN.FECHA_ATENCION) = CURDATE()
			)
			ORDER BY tk.fecha_hora_prog_alg_2_tiempo asc
			LIMIT 1
 		]]> 
	</select>
	<!-- FIN CAMBIO VBR 20191124VBR -->
	<select id="getNextTicketEst0_Alg3"
		parameterClass="java.util.HashMap" resultMap="getTicketId">
		select tk.id
		from tbl_ticket tk
		where date_format(tk.fecha_atencion, "%y/%m/%d")= 	date_format(now(), "%y/%m/%d") 
		and tk.estado =0
		and tk.id_subgrupo in
		(select sgr.id from tbl_subgrupo sgr 
			where sgr.id_grupo= #idGrupo:INTEGER#)
		order by tk.hora_emision ASC
		limit 1
	</select>
	<select id="getNextTicketGrupo_Alg3"
		parameterClass="java.util.HashMap" resultMap="getTicketId">

		SELECT tk.id 
		FROM tbl_ticket tk
		where date_format(tk.fecha_atencion, "%y/%m/%d")=
		date_format(now(),
		"%y/%m/%d") and tk.estado = 0
		and tk.id_subgrupo in
		(select sgr.id from
		tbl_subgrupo sgr where sgr.id_grupo=
		#idGrupo:INTEGER#)
		order by
		tk.hora_emision
		limit 1

	</select>
<!-- 20191201 VBR -->
	<select id="sonidoTimbreTicket"
		parameterClass="java.util.HashMap" resultMap="getTicketIdSonido">
		SELECT TK.ID   
		FROM TBL_TICKET TK
		inner JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
		inner JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
		WHERE Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d') 
        and tk.envia_audio=1 and tk.estado=41
		AND TK.ID_SUBGRUPO  IN (SELECT   SGR.ID
            FROM TBL_SUBGRUPO SGR ,  TBL_GRUPO GR , TBL_ROL_EQUIPO_GRUPO REG, TBL_ROL_EQUIPO RE
            WHERE GR.ID=SGR.ID_GRUPO 
            AND  REG.ID_GRUPO=GR.ID
            AND  RE.ID=REG.ID_ROL_EQUIPO AND RE.TIPO_EQUIPO='M' 
           	AND  RE.id=#iRolEquipo:INTEGER#)
		order by TK.fecha_atencion ASC
		limit 1
	</select>

	<select id="getCantidadTicketEspera"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		SELECT COUNT(*) FROM
		tbl_ticket t
		INNER JOIN tbl_subgrupo s ON t.id_subgrupo = s.id
		INNER
		JOIN tbl_grupo g ON g.id = s.id_grupo
		WHERE t.estado=#estado:INTEGER#
		AND g.id =#idGrupo:INTEGER# AND
		fecha_atencion=CURDATE()
	</select>

	<select id="getCantidadTicketEsperaAllGrupo"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) 
			FROM 	tbl_ticket t
			INNER JOIN tbl_subgrupo s ON t.id_subgrupo = s.id
			INNER JOIN tbl_grupo g ON g.id = s.id_grupo
			WHERE t.estado IN (0,30,31)
			AND Date_format(t.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d') 
			AND t.ID_SUBGRUPO  IN (SELECT   SGR.ID
	            FROM TBL_SUBGRUPO SGR ,  TBL_GRUPO GR , TBL_ROL_EQUIPO_GRUPO REG, TBL_ROL_EQUIPO RE
	            WHERE GR.ID=SGR.ID_GRUPO 
	            AND  REG.ID_GRUPO=GR.ID
	            AND  RE.ID=REG.ID_ROL_EQUIPO AND RE.TIPO_EQUIPO='V' 
	           	AND  RE.id=#idRol:INTEGER#)
	        AND (
		          t.id_ventanilla_derivacion = #idVentanilla:INTEGER#
		       OR 
		          (
		            t.id_ventanilla_derivacion = 0
		            AND NOT EXISTS (
		              SELECT 1
		                FROM tbl_ticket_derivacion td
		               WHERE td.id_ticket_derivado = t.id
		                 AND td.id_ticket_origen IN (
		                   SELECT id
		                     FROM tbl_ticket
		                    WHERE ventanilla_id_usuario = #idUsuario:INTEGER#
		                      AND DATE(fecha_atencion) = CURDATE()
		                 )
		            )
		          )
		     )
		]]>
	</select>
	<select id="getCantidadTicketEsperaAllSubGrupo"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) 
			FROM tbl_ticket t
			INNER JOIN tbl_subgrupo s ON s.id = t.id_subgrupo
			INNER JOIN tbl_grupo g ON g.id = s.id_grupo
			INNER JOIN tbl_rol_equipo_subgrupo reg ON reg.id_subgrupo = s.id
			INNER JOIN tbl_rol_equipo re ON re.id = reg.id_rol_equipo AND re.id = #idRol:INTEGER# 
			WHERE t.estado IN (0,30,31)
			  AND DATE(t.fecha_atencion) = CURDATE()
			  AND re.tipo_equipo = 'VS'
			  AND (
			    t.id_ventanilla_derivacion = #idVentanilla:INTEGER#
			    OR 
			    (
			      t.id_ventanilla_derivacion = 0
			      AND t.ventanilla_id_usuario <> #idUsuario:INTEGER#
			      AND NOT EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        WHERE td.id_ticket_derivado = t.id
			      )
			    )
			    OR
			    (
			      t.id_ventanilla_derivacion = 0
			      AND EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        WHERE td.id_ticket_derivado = t.id
			      )
			      AND NOT EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        INNER JOIN tbl_ticket t_origen ON t_origen.id = td.id_ticket_origen
			        WHERE td.id_ticket_derivado = t.id
			          AND t_origen.ventanilla_id_usuario = #idUsuario:INTEGER#
			          AND DATE(t_origen.fecha_atencion) = CURDATE()
			      )
			    )
			  )
	   ]]>
	</select>
	<select id="getCantidadTicketEsperaAllVentAdmin"
		parameterClass="java.util.HashMap" resultClass="java.lang.Integer">
		<![CDATA[
			SELECT COUNT(*) 
			FROM tbl_ticket t
			INNER JOIN tbl_subgrupo s ON s.id = t.id_subgrupo
			INNER JOIN tbl_grupo g ON g.id = s.id_grupo
			INNER JOIN tbl_rol_equipo_grupo reg ON reg.id_grupo = g.id
			INNER JOIN tbl_rol_equipo re ON re.id = reg.id_rol_equipo AND re.id = 180
			WHERE t.estado IN (0,30,31)
			  AND DATE(t.fecha_atencion) = CURDATE()
			  AND re.tipo_equipo = 'VA'
			  AND (
			    t.id_ventanilla_derivacion = #idVentanilla:INTEGER#
			    OR 
			    (
			      t.id_ventanilla_derivacion = 0
			      AND t.ventanilla_id_usuario <> #idUsuario:INTEGER#
			      AND NOT EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        WHERE td.id_ticket_derivado = t.id
			      )
			    )
			    OR
			    (
			      t.id_ventanilla_derivacion = 0
			      AND EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        WHERE td.id_ticket_derivado = t.id
			      )
			      AND NOT EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        INNER JOIN tbl_ticket t_origen ON t_origen.id = td.id_ticket_origen
			        WHERE td.id_ticket_derivado = t.id
			          AND t_origen.ventanilla_id_usuario = #idUsuario:INTEGER#
			          AND DATE(t_origen.fecha_atencion) = CURDATE()
			      )
			    )
			  )
	   ]]>
	</select>

	<resultMap id="getResultTicketXLlamado" class="pe.gob.ep.iclassq.entidad.BeanTicketLlamado">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="codigo" property="codigo" jdbcType="VARCHAR" />
		<result column="nombreVentanilla" property="nombreVentanilla"  jdbcType="VARCHAR" />
		<result column="descripcionVentanilla" property="descripcionVentanilla"  jdbcType="VARCHAR" />
		<result column="nombreIdentificacion" property="nombreIdentificacion" jdbcType="VARCHAR" />
		<result column="tipodocumento" property="tipodocumento"  jdbcType="INTEGER" />
		<result column="tipodocumento_d" property="tipodocumento_d" jdbcType="VARCHAR" />
		<result column="nombrePersona" property="nombrePersona" jdbcType="VARCHAR" />
		<result column="nombreGrupo" property="nombreGrupo" jdbcType="VARCHAR" />
	</resultMap>
	<select id="getListTicketCallVoz"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXLlamado">
		SELECT 
			TK.ID as id, 
			TK.codigo as codigo, 
			vent.nombre as nombreVentanilla, 
			vent.descripcion as descripcionVentanilla,  
			TK.tipo_identificacion as tipodocumento,
			TGtipoidentificacion.descripcion as tipodocumento_d, 
			TK.descripcion as nombreIdentificacion,
			CONCAT(d.nombres, ' ', d.ape_paterno, ' ', d.ape_materno) as nombrePersona,
            grg.nombre as nombreGrupo
		FROM TBL_TICKET TK
		INNER JOIN tbl_ventanilla vent ON vent.id = TK.ventanilla_caja
		INNER JOIN TBL_SUBGRUPO SGRG ON SGRG.ID=TK.ID_SUBGRUPO
		INNER JOIN TBL_GRUPO GRG ON GRG.ID=SGRG.ID_GRUPO
		INNER JOIN TBL_TABLA_GENERAL TGtipoidentificacion ON TGtipoidentificacion.tabla='TIPO_DOCUMENTO' and  TGtipoidentificacion.codigoint=TK.tipo_identificacion
        INNER JOIN tbl_dni d ON tk.numero_identificacion = d.dni
		WHERE Date_format(TK.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d') 
		AND TK.activa_audio_texto =1
		AND TK.ID_SUBGRUPO IN (SELECT SGR.ID
								FROM TBL_SUBGRUPO SGR , TBL_GRUPO
								GR , TBL_ROL_EQUIPO_GRUPO REG,
								TBL_ROL_EQUIPO RE
								WHERE
								GR.ID=SGR.ID_GRUPO
								AND REG.ID_GRUPO=GR.ID
								AND RE.ID=REG.ID_ROL_EQUIPO
								AND RE.TIPO_EQUIPO='M'
								and RE.id= #idRolEquipo:INTEGER#)
		order by TK.fecha_atencion

	</select>
	<select id="GestionTicket_1_Codigo"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXArea">
		SELECT t.id,
		a.descripcion as area,
		IF(t.estado>50, v.nombre, '') as nombreVentanilla,
		IF(t.estado>50, user.v_usuario_username, '') as nombreUsuario,
		t.codigo,
		t.tipo_identificacion,
		t.numero_identificacion,
		t.descripcion,
		t.fecha_atencion,
		g.nombre as nombreGrupo,
		s.nombre as nombreSubGrupo,
		IF(t.estado>50, t.hora_inicio_atencion, 0) as hora_inicio_atencion,
		IF(t.estado>=60, t.hora_fin_atencion, 0) as hora_fin_atencion,
		al.descripcion as nombreAlgoritmo,
		t.hora_emision as horaTicket,
		if(t.estado>50,TIMEDIFF(if (t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_fin_atencion, t.hora_inicio_atencion), if(t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_inicio_atencion,
		t.hora_fin_atencion)), 0) as tiempoAtencion,
		TIME_FORMAT(SEC_TO_TIME(TIMESTAMPDIFF(SECOND, t.hora_emision, IFNULL(t.hora_inicio_atencion, CURRENT_TIME))), '%H:%i:%s') as tiempoEspera,
		tad.tipo as tipoAnulacion,
		tad.descripcion as descripcionAnulacion,
		t_estado.descripcion as estadoDescripcion,
		t_evaluacion.descripcion as evaluacion
		from tbl_ticket t
		inner join 	tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		 LEFT join tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join tbl_area a on a.id = g.id_area
		left join ctrl_seg_usuario user on user.i_usuario_id=t.ventanilla_id_usuario 
		left join tbl_tabla_general t_estado on t_estado.TABLA='ESTADO_TICKET' and t_estado.codigoint=t.estado 
		left join tbl_tabla_general	t_evaluacion on t_evaluacion.TABLA='EVALUACION_VALOR' and t_evaluacion.codigoint=t.evaluacion
		left join tbl_ticket_adicionales tad on t.id=tad.id_ticket
		WHERE Date_format(t.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d')
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND ( #idVentanilla:INTEGER# =0  or t.ventanilla_caja=#idVentanilla:INTEGER#) 
		AND ( #idGrupo:INTEGER# =0  or s.id_grupo=#idGrupo:INTEGER#)
		AND ( #idOperador:INTEGER# =0  or t.ventanilla_id_usuario =#idOperador:INTEGER#)
		AND ( #idEstado:INTEGER# =-1  or t.estado=#idEstado:INTEGER#)		
		AND ( a.id in ( select a1.id 
						from tbl_area a1, ctrl_seg_usuario us1
						where us1.I_USUARIO_ID=#idUsuario:INTEGER#  
						and (   (us1.I_AREA=0  and us1.I_SUCURSAL=a1.id_sucursal)
						 	 or (us1.I_AREA>0 and us1.I_AREA=a1.id)
				     ))
			)
		AND ( #cApellido:STRING#='0' or  t.codigo like #cApellido:STRING#)
		ORDER BY g.id_area ,v.nombre, t.fecha_atencion, t.hora_emision
	</select>

	<select id="GestionTicket_1_Apellido"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXArea">
		SELECT t.id,
		a.descripcion as area,
		IF(t.estado>50, v.nombre, '') as nombreVentanilla,
		IF(t.estado>50, user.v_usuario_username, '') as nombreUsuario,
		t.codigo,
		t.tipo_identificacion,
		t.numero_identificacion,
		t.descripcion,
		t.fecha_atencion,
		g.nombre as nombreGrupo,
		s.nombre as nombreSubGrupo,
		IF(t.estado>50, t.hora_inicio_atencion, 0) as hora_inicio_atencion,
		IF(t.estado>=60, t.hora_fin_atencion, 0) as hora_fin_atencion,
		al.descripcion as nombreAlgoritmo,
		t.hora_emision as horaTicket,
		if(t.estado>50,TIMEDIFF(if (t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_fin_atencion, t.hora_inicio_atencion), if(t.hora_fin_atencion>t.hora_inicio_atencion, t.hora_inicio_atencion,
		t.hora_fin_atencion)), 0) as tiempoAtencion,
		if(t.estado>50,TIMEDIFF(if	(t.hora_inicio_atencion>t.hora_emision, t.hora_inicio_atencion, t.hora_emision), if (t.hora_inicio_atencion>t.hora_emision,
		t.hora_emision, t.hora_inicio_atencion)),TIME_FORMAT(TIMEDIFF(CURRENT_TIME, t.hora_emision), "%i:%s") )  as tiempoEspera,
		tad.tipo as tipoAnulacion,
		tad.descripcion as descripcionAnulacion,
		t_estado.descripcion as estadoDescripcion,
		t_evaluacion.descripcion as evaluacion
		from tbl_ticket t
		inner join 	tbl_subgrupo s on s.id = t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		inner join tbl_algoritmo al on al.id = g.id_algoritmo
		LEFT join tbl_ventanilla v on v.id = t.ventanilla_caja
		inner join tbl_area a on a.id = g.id_area
		left join ctrl_seg_usuario user on user.i_usuario_id=t.ventanilla_id_usuario 
		left join tbl_tabla_general t_estado on t_estado.TABLA='ESTADO_TICKET' and t_estado.codigoint=t.estado 
		left join tbl_tabla_general	t_evaluacion on t_evaluacion.TABLA='EVALUACION_VALOR' and t_evaluacion.codigoint=t.evaluacion
		left join tbl_ticket_adicionales tad on t.id=tad.id_ticket
		WHERE Date_format(t.FECHA_ATENCION, '%Y/%M/%d')= Date_format(now(),'%Y/%M/%d')
		AND ( #idArea:INTEGER# =0  or a.id=#idArea:INTEGER#)
		AND ( #idVentanilla:INTEGER# =0  or t.ventanilla_caja=#idVentanilla:INTEGER#) 
		AND ( #idGrupo:INTEGER# =0  or s.id_grupo=#idGrupo:INTEGER#)
		AND ( #idOperador:INTEGER# =0  or t.ventanilla_id_usuario =#idOperador:INTEGER#)
		AND ( #idEstado:INTEGER# =-1  or t.estado=#idEstado:INTEGER#)		
		AND ( a.id in ( select a1.id 
						from tbl_area a1, ctrl_seg_usuario us1
						where us1.I_USUARIO_ID=#idUsuario:INTEGER#  
						and (   (us1.I_AREA=0  and us1.I_SUCURSAL=a1.id_sucursal)
						 	 or (us1.I_AREA>0 and us1.I_AREA=a1.id)
				     ))
			)
		AND ( #cApellido:STRING#='0' or  t.descripcion like #cApellido:STRING#)
		ORDER BY g.id_area ,v.nombre, t.fecha_atencion, t.hora_emision
	</select>

	<resultMap id="getResultTicketXReporte"
		class="pe.gob.ep.iclassq.entidad.BeanTicketXReporte">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="codigo" property="codigo" jdbcType="VARCHAR" />
		<result column="nombreGrupo" property="nombreGrupo"
			jdbcType="VARCHAR" />
		<result column="hora_emision" property="horaEmision"
			jdbcType="TIME" />
		<result column="tiempoEspera" property="tiempoEspera"
			jdbcType="VARCHAR" />

	</resultMap>

	<select id="getResultConsultaTicket"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXReporte">
		select t.id, t.codigo,
		g.nombre as nombreGrupo, t.hora_emision,
		TIME_FORMAT(TIMEDIFF(CURRENT_TIME, t.hora_emision), "%i:%s") as
		tiempoEspera
		from tbl_ticket t
		inner join tbl_subgrupo s on s.id =
		t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		where
		t.estado=#estado:INTEGER# AND t.fecha_atencion=#fechaAtencion:DATE#
		AND g.id_area=#idArea:INTEGER#
		ORDER BY t.hora_emision DESC

	</select>

	<select id="getResultGestionTicket"
		parameterClass="java.util.HashMap" resultMap="getResultTicketXReporte">
		select t.id, t.codigo,
		g.nombre as nombreGrupo, t.hora_emision,
		TIME_FORMAT(TIMEDIFF(CURRENT_TIME, t.hora_emision), "%i:%s") as
		tiempoEspera
		from tbl_ticket t
		inner join tbl_subgrupo s on s.id =
		t.id_subgrupo
		inner join tbl_grupo g on g.id = s.id_grupo
		where
		t.estado=#estado:INTEGER# AND t.fecha_atencion=#fechaAtencion:DATE#
		ORDER BY t.hora_emision DESC

	</select>
	<resultMap id="getProximosTurnosArea" class="pe.gob.ep.iclassq.entidad.BeanTicketAreaproxTurno">
			<!-- WARNING - This element is automatically generated by Apache iBATIS 
				ibator, do not modify. -->
			<result column="id" property="id" jdbcType="INTEGER" />
			<result column="descripcion" property="Descripcion" jdbcType="VARCHAR" />
			<result column="idArea" property="idArea" jdbcType="INTEGER" />
			<result column="fecha_hora_prog_alg_2" property="fecha_hora_prog_alg_2" jdbcType="DATE" />
		</resultMap>	
	<select id="getProximosTurnosArea" parameterClass="java.util.HashMap" resultMap="getProximosTurnosArea">
		select t.id, t.descripcion, g.id_area as idArea, t.fecha_hora_prog_alg_2_tiempo as fecha_hora_prog_alg_2 
		from tbl_ticket t
		inner join tbl_subgrupo s on s.id = t.id_subgrupo 
		inner join tbl_grupo g on g.id = s.id_grupo
		where g.id_area=#idArea:INTEGER# and   t.fecha_atencion=#fechaAtencion:DATE# 
		and   t.estado=0
		order by fecha_hora_prog_alg_2_tiempo asc
		limit 10
	</select>
		<select id="getCantidadRegistrosActualesSG" parameterClass="java.util.HashMap" resultClass="java.lang.Integer" >
    
    	SELECT COUNT(tk.id) as Cantidad 
		FROM tbl_ticket tk	
		where date_format(tk.fecha_atencion, "%y/%m/%d")= date_format(now(), "%y/%m/%d")
		and tk.hora_fin_atencion >=ADDTIME(NOW( ), '-01:00:00') 
		and  date_format(tk.fecha_atencion, "%y/%m/%d")= date_format(now(), "%y/%m/%d")
		and tk.estado = 60 
		and  tk.id_subgrupo =#idSubGrupo:INTEGER# 
	</select>  
	
	<resultMap id="getNombreGrupoxSubGrupo" class="pe.gob.ep.iclassq.entidad.BeanTicketXGrupo">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="nombreGrupo" property="nombreGrupo" jdbcType="VARCHAR" />
		<result column="tiempoObjetivo" property="tiempoObjetivo" jdbcType="INTEGER" />
	</resultMap>

	<select id="getNombreGrupo" parameterClass="java.util.HashMap" resultMap="getNombreGrupoxSubGrupo">
			SELECT b.id, b.nombre as nombreGrupo, b.tiempo_objetivo as tiempoObjetivo
			FROM tbl_subgrupo a
			INNER JOIN tbl_grupo b ON b.id = a.id_grupo
			WHERE a.id = #idSubGrupo:INTEGER# 
	</select>
	
	<resultMap id="getResultTicketPreview" class="pe.gob.ep.iclassq.entidad.BeanTicketPreview">
		<!-- WARNING - This element is automatically generated by Apache iBATIS 
			ibator, do not modify. -->
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="codigo" property="codigo" jdbcType="VARCHAR" />
		<result column="grupo" property="grupo"  jdbcType="VARCHAR" />
		<result column="subgrupo" property="subgrupo"  jdbcType="VARCHAR" />
		<result column="numeroDocumento" property="numeroDocumento" jdbcType="VARCHAR" />
		<result column="nombrePersona" property="nombrePersona" jdbcType="VARCHAR" />
		<result column="horaEmision" property="horaEmision" jdbcType="TIME" />
		<result column="estado" property="estado" jdbcType="INTEGER" />
	</resultMap>
	<select id="listResultTicketPreview" parameterClass="java.util.HashMap" resultMap="getResultTicketPreview">
        <![CDATA[
			SELECT t.id, 
					t.codigo, 
					g.nombre as grupo,
			        s.nombre as subgrupo, 
			        t.numero_identificacion as numeroDocumento, 
			        CONCAT(d.nombres, ' ', d.ape_paterno, ' ', d.ape_materno) AS nombrePersona,
			        t.hora_emision as horaEmision,
			        t.estado
			FROM tbl_ticket t
			INNER JOIN tbl_subgrupo s ON s.id = t.id_subgrupo
			INNER JOIN tbl_grupo g ON g.id = s.id_grupo
			INNER JOIN tbl_rol_equipo_subgrupo reg ON reg.id_subgrupo = s.id
			INNER JOIN tbl_rol_equipo re ON re.id = reg.id_rol_equipo AND re.id = #idRol:INTEGER# 
			INNER JOIN tbl_dni d ON t.numero_identificacion = d.dni
			WHERE t.estado = 0
			  AND DATE(t.fecha_atencion) = CURDATE()
			  AND re.tipo_equipo = 'VS'
			  AND (
			    t.id_ventanilla_derivacion = #idVentanilla:INTEGER#
			    OR 
			    (
			      t.id_ventanilla_derivacion = 0
			      AND re.puede_jalar = 1
			      AND t.ventanilla_id_usuario <> #idUsuario:INTEGER#
			      AND NOT EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        WHERE td.id_ticket_derivado = t.id
			      )
			    )
			    OR
			    (
			      t.id_ventanilla_derivacion = 0
			      AND EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        WHERE td.id_ticket_derivado = t.id
			      )
			      AND (
			        (re.puede_jalar = 0 AND EXISTS (
			          SELECT 1 
			          FROM tbl_rol_equipo_subgrupo reg2 
			          INNER JOIN tbl_rol_equipo re2 ON re2.id = reg2.id_rol_equipo 
			          WHERE reg2.id_subgrupo = s.id 
			            AND re2.puede_jalar = 0
			            AND re2.tipo_equipo = 'VS'
			        ))
			        OR
			        (re.puede_jalar = 1 AND NOT EXISTS (
			          SELECT 1 
			          FROM tbl_rol_equipo_subgrupo reg2 
			          INNER JOIN tbl_rol_equipo re2 ON re2.id = reg2.id_rol_equipo 
			          WHERE reg2.id_subgrupo = s.id 
			            AND re2.puede_jalar = 0
			            AND re2.tipo_equipo = 'VS'
			        ))
			      )
			      AND NOT EXISTS (
			        SELECT 1
			        FROM tbl_ticket_derivacion td
			        INNER JOIN tbl_ticket t_origen ON t_origen.id = td.id_ticket_origen
			        WHERE td.id_ticket_derivado = t.id
			          AND t_origen.ventanilla_id_usuario = #idUsuario:INTEGER#
			          AND DATE(t_origen.fecha_atencion) = CURDATE()
			      )
			    )
			  )
		  ORDER BY t.hora_emision ASC;
	   ]]>
	</select>
	
	<select id="getOldestWaitingTicket" resultMap="ibatorgenerated_BaseResultMap">
		SELECT t.id, t.codigo, t.id_sucursal, t.hora_emision, t.hora_inicio_atencion, t.hora_fin_atencion,
              t.id_subgrupo, t.hora_inicio_reactivacion, t.hora_fin_reactivacion, t.fecha_hora_prog_alg_2_tiempo,
              t.estado, t.secuencia_algo_3_proporcion, t.id_ticket_derivado, t.nombre_subgrupo, t.prefijo,
              t.id_ventanilla_derivacion, t.activa_audio_texto, t.tipo_identificacion, t.numero_identificacion,
              t.descripcion, t.ventanilla_id_usuario, t.ticket_secuencia, t.envia_audio, t.ventanilla_caja,
              t.evaluacion, t.fecha_atencion
        FROM tbl_ticket t
        INNER JOIN tbl_subgrupo s ON s.id = t.id_subgrupo
        INNER JOIN tbl_rol_equipo_subgrupo reg ON reg.id_subgrupo = s.id
        WHERE t.estado = 0
        AND DATE(t.fecha_atencion) = CURDATE()
        AND reg.id_rol_equipo = #idRolEquipo:INTEGER#
        AND t.id_sucursal = #idSucursal:INTEGER#
        ORDER BY t.hora_emision ASC
        LIMIT 1
    </select>

    <update id="assignTicketToUser" parameterClass="java.util.HashMap">
		UPDATE tbl_ticket
	     SET ventanilla_id_usuario = #idUsuario:INTEGER#, 
	         estado = 40
	   WHERE id = #idTicket:INTEGER#
	     AND estado = 0
	     AND (ventanilla_id_usuario IS NULL OR ventanilla_id_usuario = 0)
    </update>
    
    <select id="contarTicketsAtendidosDia" parameterClass="java.util.HashMap" resultClass="int">
	    SELECT COUNT(*) 
	    FROM tbl_ticket t
		WHERE t.ventanilla_id_usuario = #idUsuario:INTEGER#
		  AND t.fecha_atencion = CURDATE()
		  AND t.hora_fin_atencion IS NOT NULL
		  AND t.estado IN (60) 
	</select>
	
	<resultMap id="getReportTicketManagement" class="pe.gob.ep.iclassq.entidad.BeanTicketManagement">
		<result column="idTicket" property="idTicket" jdbcType="INTEGER" />
		<result column="idEstado" property="idEstado" jdbcType="INTEGER" />
		<result column="zona" property="zona" jdbcType="VARCHAR" />
		<result column="sucursal" property="sucursal" jdbcType="VARCHAR" />
		<result column="ejecutivo" property="ejecutivo" jdbcType="VARCHAR" />
		<result column="ventanilla" property="ventanilla" jdbcType="VARCHAR" />
		<result column="numeroDocumento" property="numeroDocumento" jdbcType="VARCHAR" />
		<result column="cliente" property="cliente" jdbcType="VARCHAR" />
		<result column="grupo" property="grupo" jdbcType="VARCHAR" />
		<result column="subgrupo" property="subgrupo" jdbcType="VARCHAR" />
		<result column="horaEmision" property="horaEmision" jdbcType="VARCHAR" />
		<result column="horaInicioAtencion" property="horaInicioAtencion" jdbcType="VARCHAR" />
		<result column="horaFinAtencion" property="horaFinAtencion" jdbcType="VARCHAR" />
		<result column="tiempoAtencion" property="tiempoAtencion" jdbcType="VARCHAR" />
		<result column="tiempoEspera" property="tiempoEspera" jdbcType="VARCHAR" />
		<result column="estado" property="estado" jdbcType="VARCHAR" />
	</resultMap>
	
	<sql id="whereFiltrosTicketManagement">
	  WHERE 1 = 1
	  AND DATE(t.fecha_atencion) = CURDATE()
	  AND t.estado IN (0,40,50,60,70,92,93)
	  AND (
		t.estado IN (0,40,50)
		OR (
		    t.estado IN (60,70,92,93)
		    AND TIMESTAMPDIFF(
		          SECOND,
		          COALESCE(t.hora_fin_atencion, t.hora_emision),
		          NOW()
		        ) &lt;= 30
		   )
      )
	  AND (
		  #zona# IS NULL
		  OR #zona# = 0
		  OR zk.id = #zona#
	  )
		
	  <isNotNull property="grupos">
	    <isNotEmpty property="grupos">
	      AND (
	        <iterate property="grupos" open="" close="" conjunction=" OR ">
	          gr.nombre LIKE CONCAT('%', #grupos[]#, '%')
	        </iterate>
	      )
	    </isNotEmpty>
	  </isNotNull>
	
	  <isNotNull property="sucursales">
	    <isNotEmpty property="sucursales">
	      AND s.id IN
	      <iterate property="sucursales" open="(" close=")" conjunction=",">
	        #sucursales[]#
	      </iterate>
	    </isNotEmpty>
	  </isNotNull>
	</sql>
	
	<select id="listReportTicketManagement" parameterClass="java.util.HashMap" resultMap="getReportTicketManagement" > 
		SELECT
		  t.id as idTicket,
		  t.estado as idEstado,
		  zk.descripcion AS zona,
		  s.nombre AS sucursal,
		  COALESCE(CONCAT(u.V_USUARIO_NOMBRES, ' ', u.V_USUARIO_AP_PATERNO, ' ', u.V_USUARIO_AP_MATERNO), '--') AS ejecutivo,
		  COALESCE(v.nombre, '--') AS ventanilla,
		  t.numero_identificacion AS numeroDocumento,
		  CONCAT_WS(' ', dn.nombres, dn.ape_paterno, dn.ape_materno) AS cliente,
		  gr.nombre AS grupo,
		  sg.nombre AS subgrupo,
		  COALESCE(t.hora_emision, '--') AS horaEmision,
		  COALESCE(t.hora_inicio_atencion, '--') AS horaInicioAtencion,
		  COALESCE(t.hora_fin_atencion, '--') AS horaFinAtencion,
		  COALESCE(SEC_TO_TIME(
            TIMESTAMPDIFF(SECOND, t.hora_inicio_atencion, t.hora_fin_atencion) +
            CASE 
              WHEN t.hora_inicio_reactivacion IS NOT NULL 
                   AND t.hora_fin_reactivacion IS NOT NULL 
              THEN TIMESTAMPDIFF(SECOND, t.hora_inicio_reactivacion, t.hora_fin_reactivacion)
              ELSE 0
            END
          ), '--') AS tiempoAtencion,
		COALESCE(
			SEC_TO_TIME(
				TIMESTAMPDIFF(
					SECOND,
					t.hora_emision,
					COALESCE(t.hora_inicio_atencion, NOW())
				)
			),
			'--'
		) AS tiempoEspera,
	  	tg.descripcion AS estado
		FROM tbl_ticket t
		INNER JOIN tbl_tabla_general tg ON tg.TABLA = 'ESTADO_TICKET' AND tg.codigoint = t.estado
		INNER JOIN tbl_subgrupo sg ON sg.id = t.id_subgrupo
		INNER JOIN tbl_grupo gr ON gr.id = sg.id_grupo
		INNER JOIN tbl_sucursal s ON s.id = t.id_sucursal
		LEFT JOIN cat_zona_kon zk ON zk.id = s.zona
		LEFT JOIN ctrl_seg_usuario u ON u.I_USUARIO_ID = t.ventanilla_id_usuario
		LEFT JOIN tbl_ventanilla v ON v.id = u.I_VENTANILLA
		LEFT JOIN tbl_dni dn  ON dn.dni = t.numero_identificacion
   	    <include refid="whereFiltrosTicketManagement"/>
		ORDER BY t.hora_emision DESC;
	</select>
</sqlMap>