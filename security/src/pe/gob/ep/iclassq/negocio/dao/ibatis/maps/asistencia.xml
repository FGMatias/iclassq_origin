<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_asistencia" >
  <resultMap id="ibatorgenerated_BaseResultMap" class="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <result column="id" property="id" jdbcType="INTEGER" />
    <result column="id_usuario" property="idUsuario" jdbcType="INTEGER" />
    <result column="hora_ingreso" property="horaIngreso" jdbcType="TIME" />
    <result column="hora_salida" property="horaSalida" jdbcType="TIME" />
    <result column="fecha" property="fecha" jdbcType="DATE" />
    <result column="estado" property="estado" jdbcType="INTEGER" />
  </resultMap>
  <sql id="ibatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" resultMap="ibatorgenerated_BaseResultMap" parameterClass="pe.gob.ep.iclassq.negocio.bean.AsistenciaCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select id, id_usuario, hora_ingreso, hora_salida, fecha, estado
    from tbl_asistencia
    <isParameterPresent >
      <include refid="tbl_asistencia.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" resultMap="ibatorgenerated_BaseResultMap" parameterClass="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select id, id_usuario, hora_ingreso, hora_salida, fecha, estado
    from tbl_asistencia
    where id = #id:INTEGER#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from tbl_asistencia
    where id = #id:INTEGER#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="pe.gob.ep.iclassq.negocio.bean.AsistenciaCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    delete from tbl_asistencia
    <include refid="tbl_asistencia.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into tbl_asistencia (id, id_usuario, hora_ingreso, hora_salida, fecha, estado)
    values (#id:INTEGER#, #idUsuario:INTEGER#, #horaIngreso:TIME#, #horaSalida:TIME#, #fecha:DATE#,
      #estado:INTEGER#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    insert into tbl_asistencia
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        id
      </isNotNull>
      <isNotNull prepend="," property="idUsuario" >
        id_usuario
      </isNotNull>
      <isNotNull prepend="," property="horaIngreso" >
        hora_ingreso
      </isNotNull>
      <isNotNull prepend="," property="horaSalida" >
        hora_salida
      </isNotNull>
      <isNotNull prepend="," property="fecha" >
        fecha
      </isNotNull>
      <isNotNull prepend="," property="estado" >
        estado
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="id" >
        #id:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="idUsuario" >
        #idUsuario:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="horaIngreso" >
        #horaIngreso:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaSalida" >
        #horaSalida:TIME#
      </isNotNull>
      <isNotNull prepend="," property="fecha" >
        #fecha:DATE#
      </isNotNull>
      <isNotNull prepend="," property="estado" >
        #estado:INTEGER#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="pe.gob.ep.iclassq.negocio.bean.AsistenciaCriteria" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    select count(*) from tbl_asistencia
    <include refid="tbl_asistencia.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_asistencia
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.id" >
        id = #record.id:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.idUsuario" >
        id_usuario = #record.idUsuario:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.horaIngreso" >
        hora_ingreso = #record.horaIngreso:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.horaSalida" >
        hora_salida = #record.horaSalida:TIME#
      </isNotNull>
      <isNotNull prepend="," property="record.fecha" >
        fecha = #record.fecha:DATE#
      </isNotNull>
      <isNotNull prepend="," property="record.estado" >
        estado = #record.estado:INTEGER#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_asistencia.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_asistencia
    set id = #record.id:INTEGER#,
      id_usuario = #record.idUsuario:INTEGER#,
      hora_ingreso = #record.horaIngreso:TIME#,
      hora_salida = #record.horaSalida:TIME#,
      fecha = #record.fecha:DATE#,
      estado = #record.estado:INTEGER#
    <isParameterPresent >
      <include refid="tbl_asistencia.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_asistencia
    <dynamic prepend="set" >
      <isNotNull prepend="," property="idUsuario" >
        id_usuario = #idUsuario:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="horaIngreso" >
        hora_ingreso = #horaIngreso:TIME#
      </isNotNull>
      <isNotNull prepend="," property="horaSalida" >
        hora_salida = #horaSalida:TIME#
      </isNotNull>
      <isNotNull prepend="," property="fecha" >
        fecha = #fecha:DATE#
      </isNotNull>
      <isNotNull prepend="," property="estado" >
        estado = #estado:INTEGER#
      </isNotNull>
    </dynamic>
    where id = #id:INTEGER#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="pe.gob.ep.iclassq.negocio.bean.Asistencia" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
    -->
    update tbl_asistencia
    set id_usuario = #idUsuario:INTEGER#,
      hora_ingreso = #horaIngreso:TIME#,
      hora_salida = #horaSalida:TIME#,
      fecha = #fecha:DATE#,
      estado = #estado:INTEGER#
    where id = #id:INTEGER#
  </update>
  
  <resultMap id="getDataAttendance" class="pe.gob.ep.iclassq.entidad.BeanReporteAsistencia">
		<result column="id_usuario" property="idUsuario" jdbcType="INTEGER" />
		<result column="usuario" property="usuario" jdbcType="VARCHAR" />
		<result column="ventanilla" property="ventanilla" jdbcType="VARCHAR" />
		<result column="sucursal" property="sucursal" jdbcType="VARCHAR" />
		<result column="fecha" property="fecha" jdbcType="VARCHAR" />
		<result column="hora_entrada" property="horaEntrada" jdbcType="VARCHAR" />
		<result column="hora_salida" property="horaSalida" jdbcType="VARCHAR" />
		<result column="tiempo_conexion" property="tiempoConexion" jdbcType="VARCHAR" />
		<result column="refrigerio" property="refrigerio" jdbcType="VARCHAR" />
		<result column="ss_hh" property="sshh" jdbcType="VARCHAR" />
		<result column="capacitacion" property="capacitacion" jdbcType="VARCHAR" />
		<result column="gestion_interna" property="gestionInterna" jdbcType="VARCHAR" />
		<result column="ocupacion" property="ocupacion" jdbcType="VARCHAR" />
		<result column="desconexion" property="desconexion" jdbcType="VARCHAR" />
		<result column="disponible" property="disponible" jdbcType="VARCHAR" />
	</resultMap>	

	<select id="listDataAttendance" parameterClass="java.util.HashMap" resultMap="getDataAttendance" > 
			WITH
				asist_all AS (
				  SELECT id_usuario, fecha, hora_ingreso, hora_salida
				  FROM tbl_asistencia
				  UNION ALL
				  SELECT id_usuario, fecha, hora_ingreso, hora_salida
				  FROM tbl_asistencia_historico
				),
				aus_all AS (
				  SELECT id_usuario, fecha, hora_inicio, hora_fin, id_motivo_ausencia
				  FROM tbl_usuario_ausencia
				  UNION ALL
				  SELECT id_usuario, fecha, hora_inicio, hora_fin, id_motivo_ausencia
				  FROM tbl_usuario_ausencia_historico
				),
				tkt_all AS (
				  SELECT
				    t.ventanilla_id_usuario AS id_usuario,
				    t.fecha_atencion AS fecha,
				    t.hora_inicio_atencion,
				    t.hora_fin_atencion,
				    t.hora_inicio_reactivacion,
				    t.hora_fin_reactivacion
				  FROM tbl_ticket t
				  UNION ALL
				  SELECT
				    t.ventanilla_id_usuario,
				    t.fecha_atencion,
				    t.hora_inicio_atencion,
				    t.hora_fin_atencion,
				    t.hora_inicio_reactivacion,
				    t.hora_fin_reactivacion
				  FROM tbl_ticket_historico t
				),
				last_ticket AS (
				  SELECT
				    x.id_usuario,
				    x.fecha,
				    MAX(
				      GREATEST(
				        COALESCE(TIME_TO_SEC(x.hora_fin_atencion),0),
				        COALESCE(TIME_TO_SEC(x.hora_fin_reactivacion),0)
				      )
				    ) AS last_ticket_sec
				  FROM tkt_all x
				  WHERE ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (x.fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				  GROUP BY x.id_usuario, x.fecha
				),
				last_aus AS (
				  SELECT
				    a.id_usuario,
				    a.fecha,
				    MAX(COALESCE(TIME_TO_SEC(a.hora_fin), TIME_TO_SEC(a.hora_inicio))) AS last_aus_sec
				  FROM aus_all a
				  WHERE ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (a.fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				  GROUP BY a.id_usuario, a.fecha
				),
				last_event AS (
				  SELECT
				    u.id_usuario,
				    u.fecha,
				    SEC_TO_TIME(GREATEST(IFNULL(t.last_ticket_sec,0), IFNULL(s.last_aus_sec,0))) AS last_any_time
				  FROM (
				    SELECT DISTINCT id_usuario, fecha
				    FROM asist_all
				    WHERE ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				  ) u
				  LEFT JOIN last_ticket t USING (id_usuario, fecha)
				  LEFT JOIN last_aus s USING (id_usuario, fecha)
				),
				conex AS (
				  SELECT
				    a.id_usuario,
				    a.fecha,
				    MIN(a.hora_ingreso) AS min_ingreso,
				    MAX(
				      COALESCE(
				        a.hora_salida,
				        CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				             ELSE le.last_any_time END,
				        a.hora_ingreso
				      )
				    ) AS max_salida,
				    SUM(
				      GREATEST(
				        0,
				        TIME_TO_SEC(
				          TIMEDIFF(
				            COALESCE(
				              a.hora_salida,
				              CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				                   ELSE le.last_any_time END,
				              a.hora_ingreso
				            ),
				            a.hora_ingreso
				          )
				        )
				      )
				    ) AS seg_conexion
				  FROM asist_all a
				  LEFT JOIN last_event le ON le.id_usuario = a.id_usuario AND le.fecha = a.fecha
				  WHERE ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (a.fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				  GROUP BY a.id_usuario, a.fecha
				),
				sesiones AS (
				  SELECT
				    a.id_usuario,
				    a.fecha,
				    a.hora_ingreso AS hin,
				    COALESCE(
				      a.hora_salida,
				      CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				           ELSE le.last_any_time END,
				      a.hora_ingreso
				    ) AS hout
				  FROM asist_all a
				  LEFT JOIN last_event le ON le.id_usuario = a.id_usuario AND le.fecha = a.fecha
				  WHERE ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (a.fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				),
				descon AS (
				  SELECT
				    id_usuario,
				    fecha,
				    SUM(gap_seg) AS seg_desconexion
				  FROM (
				    SELECT
				      s.id_usuario,
				      s.fecha,
				      LEAD(s.hin) OVER (PARTITION BY s.id_usuario, s.fecha ORDER BY s.hin) AS next_hin,
				      s.hout,
				      CASE
				        WHEN LEAD(s.hin) OVER (PARTITION BY s.id_usuario, s.fecha ORDER BY s.hin) IS NULL
				          THEN 0
				        ELSE GREATEST(
				               0,
				               TIME_TO_SEC(
				                 TIMEDIFF(
				                   LEAD(s.hin) OVER (PARTITION BY s.id_usuario, s.fecha ORDER BY s.hin),
				                   s.hout
				                 )
				               )
				             )
				      END AS gap_seg
				    FROM sesiones s
				  ) z
				  GROUP BY id_usuario, fecha
				),
				aus_pivot AS (
				  SELECT
				    a.id_usuario,
				    a.fecha,
				    SUM(CASE WHEN a.id_motivo_ausencia = 3
				             THEN GREATEST(0, TIME_TO_SEC(TIMEDIFF(COALESCE(a.hora_fin,
				                                                            CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				                                                                 ELSE a.hora_inicio END),
				                                                     a.hora_inicio)))
				             ELSE 0 END) AS seg_refrigerio,
				    SUM(CASE WHEN a.id_motivo_ausencia = 4
				             THEN GREATEST(0, TIME_TO_SEC(TIMEDIFF(COALESCE(a.hora_fin,
				                                                            CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				                                                                 ELSE a.hora_inicio END),
				                                                     a.hora_inicio)))
				             ELSE 0 END) AS seg_sshh,
				    SUM(CASE WHEN a.id_motivo_ausencia = 1
				             THEN GREATEST(0, TIME_TO_SEC(TIMEDIFF(COALESCE(a.hora_fin,
				                                                            CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				                                                                 ELSE a.hora_inicio END),
				                                                     a.hora_inicio)))
				             ELSE 0 END) AS seg_capacitacion,
				    SUM(CASE WHEN a.id_motivo_ausencia = 2
				             THEN GREATEST(0, TIME_TO_SEC(TIMEDIFF(COALESCE(a.hora_fin,
				                                                            CASE WHEN a.fecha = CURDATE() THEN TIME(NOW())
				                                                                 ELSE a.hora_inicio END),
				                                                     a.hora_inicio)))
				             ELSE 0 END) AS seg_gestion
				  FROM aus_all a
				  WHERE ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (a.fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				  GROUP BY a.id_usuario, a.fecha
				),
				ocup AS (
				  SELECT
				    x.id_usuario,
				    x.fecha,
				    SUM(
				      GREATEST(0, TIME_TO_SEC(TIMEDIFF(x.hora_fin_atencion, x.hora_inicio_atencion))) +
				      CASE
				        WHEN x.hora_inicio_reactivacion IS NOT NULL AND x.hora_fin_reactivacion IS NOT NULL
				          THEN GREATEST(0, TIME_TO_SEC(TIMEDIFF(x.hora_fin_reactivacion, x.hora_inicio_reactivacion)))
				        ELSE 0
				      END
				    ) AS seg_ocupacion
				  FROM tkt_all x
				  WHERE x.hora_inicio_atencion IS NOT NULL
				    AND x.hora_fin_atencion IS NOT NULL
				    AND ( #fechaInicio:DATE# = '' OR #fechaFin:DATE# = '' OR (x.fecha BETWEEN #fechaInicio:DATE# AND #fechaFin:DATE#) )
				  GROUP BY x.id_usuario, x.fecha
				),
				usuarios_base AS (
				  SELECT
				    u.I_USUARIO_ID AS id_usuario,
				    u.V_USUARIO_USERNAME AS username,
				    u.I_SUCURSAL AS sucursal_id,
				    CONCAT(u.V_USUARIO_NOMBRES,' ',u.V_USUARIO_AP_PATERNO,' ',u.V_USUARIO_AP_MATERNO) AS usuario,
				    v.descripcion AS ventanilla,
				    s.nombre AS sucursal
				  FROM ctrl_seg_usuario u
				  JOIN tbl_sucursal s ON s.id = u.I_SUCURSAL
				  JOIN tbl_ventanilla v ON v.id = u.I_VENTANILLA
				  WHERE
				    ( #idSucursal:INTEGER# = 0 OR s.id = #idSucursal:INTEGER# )
				    AND ( #idUsuario:INTEGER#  = 0 OR u.I_USUARIO_ID = #idUsuario:INTEGER# )
				    AND ( #zona:INTEGER# = 0 OR s.zona = #zona:INTEGER# )
				    <isEqual property="aplicaGrupos" compareValue="true">
				      AND EXISTS (
				        SELECT 1
				        FROM tbl_ventanilla vent
				        LEFT JOIN tbl_area are ON are.id = vent.id_area
		  				LEFT JOIN tbl_grupo g ON are.id = g.id_area
				        WHERE vent.id = u.I_VENTANILLA
				        <isNotNull property="grupos">
					      <isNotEmpty property="grupos">
					        AND UPPER(TRIM(g.nombre)) IN
					        <iterate property="grupos" open="(" close=")" conjunction=",">
					          UPPER(TRIM(#grupos[]#))
					        </iterate>
					      </isNotEmpty>
					    </isNotNull>
				      )
				    </isEqual>
				)
				SELECT
				  ub.usuario,
				  ub.username,
				  ub.ventanilla,
				  ub.sucursal,
				  c.id_usuario,
				  c.fecha,
				  TIME_FORMAT(c.min_ingreso, '%H:%i:%s') AS hora_entrada,
				  TIME_FORMAT(c.max_salida,  '%H:%i:%s') AS hora_salida,
				  TIME_FORMAT(SEC_TO_TIME(c.seg_conexion), '%H:%i:%s') AS tiempo_conexion,
				  CASE WHEN IFNULL(a.seg_refrigerio,0) > 0 THEN TIME_FORMAT(SEC_TO_TIME(a.seg_refrigerio), '%H:%i:%s') ELSE '--' END AS refrigerio,
				  CASE WHEN IFNULL(a.seg_sshh,0) > 0 THEN TIME_FORMAT(SEC_TO_TIME(a.seg_sshh), '%H:%i:%s') ELSE '--' END AS ss_hh,
				  CASE WHEN IFNULL(a.seg_capacitacion,0) > 0 THEN TIME_FORMAT(SEC_TO_TIME(a.seg_capacitacion), '%H:%i:%s') ELSE '--' END AS capacitacion,
				  CASE WHEN IFNULL(a.seg_gestion,0) > 0 THEN TIME_FORMAT(SEC_TO_TIME(a.seg_gestion), '%H:%i:%s') ELSE '--' END AS gestion_interna,
				  TIME_FORMAT(SEC_TO_TIME(IFNULL(o.seg_ocupacion,0)), '%H:%i:%s') AS ocupacion,
				  TIME_FORMAT(SEC_TO_TIME(IFNULL(d.seg_desconexion,0)), '%H:%i:%s') AS desconexion,
				  TIME_FORMAT(
				    SEC_TO_TIME(
				      GREATEST(
				        0,
				        c.seg_conexion
				        - ( IFNULL(a.seg_refrigerio,0)
				          + IFNULL(a.seg_sshh,0)
				          + IFNULL(a.seg_capacitacion,0)
				          + IFNULL(a.seg_gestion,0) )
				        - IFNULL(o.seg_ocupacion,0)
				      )
				    ),
				    '%H:%i:%s'
				  ) AS disponible
				FROM conex c
				JOIN usuarios_base ub ON ub.id_usuario = c.id_usuario
				LEFT JOIN aus_pivot a ON a.id_usuario = c.id_usuario AND a.fecha = c.fecha
				LEFT JOIN ocup o ON o.id_usuario = c.id_usuario AND o.fecha = c.fecha
				LEFT JOIN descon d ON d.id_usuario = c.id_usuario AND d.fecha = c.fecha
				WHERE
				  ( #idSucursal:INTEGER# = 0 OR ub.sucursal_id = #idSucursal:INTEGER# )
				  AND ( #idUsuario:INTEGER#  = 0 OR c.id_usuario    = #idUsuario:INTEGER# )
				ORDER BY ub.usuario, c.fecha
	</select> 
</sqlMap>